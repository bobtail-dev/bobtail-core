(function(){var a,b=[].slice,c=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},d={}.hasOwnProperty;a=function(a){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P;return N={},G=0,F=function(){return G+=1},P=function(a,c){return new Set(b.call(a).concat(b.call(c)))},C=function(a,b){return new Set(Array.from(a).filter(function(a){return b.has(a)}))},A=function(a,b){return new Set(Array.from(a).filter(function(a){return!b.has(a)}))},L=function(a,b){var c;if(!(b in a))throw new Error("object has no key "+b);return c=a[b],delete a[b],c},D=function(a,b){var c;return c=a.get(b),a.delete(b),c},H=function(a,b,c){var d,e,f,g;for(d=e=0,f=a.length;e<f;d=++e)if(g=a[d],c(g)&&(b-=1)<0)return[g,d];return[null,-1]},function(a,b){return H(a,0,b)},E=function(b){var c,d,e,f,g,h;if(null==b&&(b=[]),f=null!=Object.create?Object.create(null):{},a.isArray(b))for(c=0,e=b.length;c<e;c++)g=b[c],d=g[0],h=g[1],f[d]=h;else for(d in b)h=b[d],f[d]=h;return f},O=function(a){var b,c,d,e;for(d=0,b=0,c=a.length;b<c;b++)e=a[b],d+=e;return d},g=N.DepMgr=function(){function b(){this.buffering=0,this.buffer=[],this.events=new Set}return b.prototype.transaction=function(b){var c,d,e,f;this.buffering+=1;try{f=b()}finally{if(this.buffering-=1,0===this.buffering){e=new Set(a.flatten(Array.from(this.events).map(function(a){var b;return b=a.downstreamCells,Array.from(b)}))),c=N.allDownstream.apply(N,e),c.forEach(function(a){return a._shield=!0});try{d=this.buffer,this.buffer=[],this.events.clear(),d.map(function(a){var b,c;return c=a[0],b=a[1],c.pub(b)}),c.forEach(function(a){return a.refresh()})}finally{c.forEach(function(a){return a._shield=!1})}}}return f},b}(),N._depMgr=z=new g,i=N.Ev=function(){function a(a,b){this.init=a,this.observable=b,this.subs=E(),this.downstreamCells=new Set}return a.prototype.sub=function(a){var b;return b=F(),null!=this.init&&a(this.init()),this.subs[b]=a,b},a.prototype.pub=function(a){var b,c,d,e;if(z.buffering)return z.buffer.push([this,a]),z.events.add(this);c=this.subs,d=[];for(e in c)b=c[e],d.push(b(a));return d},a.prototype.unsub=function(a){return L(this.subs,a)},a.prototype.scoped=function(a,b){var c;c=this.sub(a);try{return b()}finally{this.unsub(c)}},a}(),N.skipFirst=function(a){var c;return c=!0,function(){var d;return d=1<=arguments.length?b.call(arguments,0):[],c?c=!1:a.apply(null,d)}},N.upstream=function(a){var b,c;return c=Array.from(a.upstreamEvents),b=c.map(function(a){return a.observable}),Array.from(new Set(b))},w=N._allDownstreamHelper=function(){var c,d;return c=1<=arguments.length?b.call(arguments,0):[],c.length?(d=Array.from(new Set(a.flatten(c.map(function(a){return Array.from(a.onSet.downstreamCells)})))),a.flatten([d,w.apply(null,d)])):[]},N.allDownstream=function(){var a;return a=1<=arguments.length?b.call(arguments,0):[],Array.from(new Set(b.call(a).concat(b.call(w.apply(null,a))).reverse())).reverse()},q=N.Recorder=function(){function c(){this.stack=[],this.isMutating=!1,this.isIgnoring=!1,this.hidingMutationWarnings=!1,this.onMutationWarning=new i}return c.prototype.record=function(b,c){var d,e;this.stack.length>0&&!this.isMutating&&a(this.stack).last().addNestedBind(b),this.stack.push(b),e=this.isMutating,this.isMutating=!1,d=this.isIgnoring,this.isIgnoring=!1;try{return c()}finally{this.isIgnoring=d,this.isMutating=e,this.stack.pop()}},c.prototype.sub=function(c,d){var e;if(null==d&&(d=function(){return!0}),this.stack.length>0&&!this.isIgnoring)return e=a(this.stack).last(),e.upstreamEvents.add(c),c.downstreamCells.add(e),N.autoSub(c,function(){var a;if(a=1<=arguments.length?b.call(arguments,0):[],d.apply(null,a))return e.refresh()})},c.prototype.addCleanup=function(b){if(this.stack.length>0)return a(this.stack).last().addCleanup(b)},c.prototype.hideMutationWarnings=function(a){var b;b=this.hidingMutationWarnings,this.hidingMutationWarnings=!0;try{return a()}finally{this.hidingMutationWarnings=b}},c.prototype.fireMutationWarning=function(){return console.warn("Mutation to observable detected during a bind context"),this.onMutationWarning.pub(null)},c.prototype.mutating=function(a){var b;this.stack.length>0&&!this.hidingMutationWarnings&&this.fireMutationWarning(),b=this.isMutating,this.isMutating=!0;try{return a()}finally{this.isMutating=b}},c.prototype.ignoring=function(a){var b;b=this.isIgnoring,this.isIgnoring=!0;try{return a()}finally{this.isIgnoring=b}},c}(),N.types={cell:"cell",array:"array",map:"map",set:"set"},N._recorder=M=new q,N.hideMutationWarnings=function(a){return M.hideMutationWarnings(a)},N.asyncBind=x=function(a,b){var c;return c=new e(b,a),c.refresh(),c},N.promiseBind=function(a,b){return x(a,function(){return this.record(b).done(function(a){return function(b){return a.done(b)}}(this))})},N.bind=y=function(a){return x(null,function(){return this.done(this.record(a))})},N.lagBind=function(a,b,c){var d;return d=null,x(b,function(){return null!=d&&clearTimeout(d),d=setTimeout(function(a){return function(){return a.done(a.record(c))}}(this),a)})},N.postLagBind=function(a,b){var c;return c=null,x(a,function(){var a,d,e;return d=this.record(b),e=d.val,a=d.ms,null!=c&&clearTimeout(c),c=setTimeout(function(a){return function(){return a.done(e)}}(this),a)})},N.snap=function(a){return M.ignoring(a)},N.onDispose=function(a){return M.addCleanup(a)},N.autoSub=function(a,b){var c;return c=a.sub(b),N.onDispose(function(){return a.unsub(c)}),c},N.subOnce=function(c,d){var e;return e=N.autoSub(c,N.skipFirst(function(){var f;return f=1<=arguments.length?b.call(arguments,0):[],a.defer(function(){return d.apply(null,f)}),c.unsub(e)}))},m=N.ObsBase=function(){function a(){this.events=[]}return a.prototype.to={cell:function(){return N.cell.from(a)},array:function(){return N.array.from(a)},map:function(){return N.map.from(a)},set:function(){return N.set.from(a)}},a.prototype.flatten=function(){return N.flatten(this)},a.prototype.subAll=function(a){return null==a&&(a=function(){return!0}),this.events.forEach(function(b){return M.sub(b,a)})},a.prototype.raw=function(){return this._base},a.prototype._mkEv=function(a){var b;return b=new i(a,this),this.events.push(b),b},a}(),n=N.ObsCell=function(a){function b(a){var c,d;this._base=a,b.__super__.constructor.call(this),this._base=null!=(d=this._base)?d:null,this.onSet=this._mkEv(function(a){return function(){return[null,a._base]}}(this)),this._shield=!1,c=function(a){return function(){return a.onSet.downstreamCells}}(this),this.refreshAll=function(a){return function(){var b;if(a.onSet.downstreamCells.size&&!a._shield){a._shield=!0,b=N.allDownstream.apply(N,Array.from(c())),b.forEach(function(a){return a._shield=!0});try{return b.forEach(function(a){return a.refresh()})}finally{b.forEach(function(a){return a._shield=!1}),a._shield=!1}}}}(this),this.refreshSub=N.autoSub(this.onSet,this.refreshAll)}return c(b,a),b.prototype.all=function(){return this.subAll(function(a){return function(){return!a._shield}}(this)),this._base},b.prototype.get=function(){return this.all()},b.prototype.readonly=function(){return new e(function(a){return function(){return a.all()}}(this))},b}(m),s=N.SrcCell=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.set=function(a){return M.mutating(function(b){return function(){var c;if(b._base!==a)return c=b._base,b._base=a,b.onSet.pub([c,a]),c}}(this))},b}(n),e=N.DepCell=function(a){function b(a,c){this.body=a,b.__super__.constructor.call(this,null!=c?c:null),this.refreshing=!1,this.nestedBinds=[],this.cleanups=[],this.upstreamEvents=new Set}return c(b,a),b.prototype.refresh=function(){var a,b,c,d,e,f;if(!this.refreshing)return c=this._base,d=function(a){return function(b){return a._base=b,a.onSet.pub([c,a._base])}}(this),e=!1,f=null,b=!1,a={record:function(c){return function(g){var h;if(!c.refreshing){if(c.disconnect(),e)throw new Error("this refresh has already recorded its dependencies");c.refreshing=!0,e=!0;try{h=M.record(c,function(){return g.call(a)})}finally{c.refreshing=!1}return b&&d(f),h}}}(this),done:function(a){return function(e){if(c!==e)return a.refreshing?(b=!0,f=e):d(e)}}(this)},this.body.call(a)},b.prototype.disconnect=function(){var a,b,c,d,e,f,g;for(f=this.cleanups,a=0,c=f.length;a<c;a++)(0,f[a])();for(g=this.nestedBinds,b=0,d=g.length;b<d;b++)e=g[b],e.disconnect();return this.nestedBinds=[],this.cleanups=[],this.upstreamEvents.forEach(function(a){return function(b){return b.downstreamCells.delete(a)}}(this)),this.upstreamEvents.clear()},b.prototype.addNestedBind=function(a){return this.nestedBinds.push(a)},b.prototype.addCleanup=function(a){return this.cleanups.push(a)},b}(n),l=N.ObsArray=function(a){function e(a,b){this._cells=null!=a?a:[],this.diff=null!=b?b:N.basicDiff(),e.__super__.constructor.call(this),this.onChange=this._mkEv(function(a){return function(){return[0,[],a._cells.map(function(a){return a.raw()})]}}(this)),this.onChangeCells=this._mkEv(function(a){return function(){return[0,[],a._cells]}}(this)),this._indexed=null}return c(e,a),e.prototype.all=function(){return M.sub(this.onChange),this._cells.map(function(a){return a.get()})},e.prototype.raw=function(){return this._cells.map(function(a){return a.raw()})},e.prototype.readonly=function(){return new d(function(a){return function(){return a.all()}}(this))},e.prototype.rawCells=function(){return this._cells},e.prototype.at=function(a){var b;return M.sub(this.onChange,function(b){var c,d,e;return d=b[0],e=b[1],c=b[2],d<=a&&e.length!==c.length||e.length===c.length&&a<=d+e.length}),null!=(b=this._cells[a])?b.get():void 0},e.prototype.length=function(){return M.sub(this.onChangeCells,function(a){var b,c;return a[0],c=a[1],b=a[2],c.length!==b.length}),this._cells.length},e.prototype.size=function(){return this.length()},e.prototype.map=function(a){var b;return b=new k,N.autoSub(this.onChangeCells,function(c){return function(c){var d,e,f,g,h,i,j,k;for(f=c[0],k=c[1],d=c[2],j=b._cells.slice(f,f+k.length),g=0,h=j.length;g<h;g++)e=j[g],e.disconnect();return i=d.map(function(b){return e=y(function(){return a(b.get())})}),b.realSpliceCells(f,k.length,i)}}()),b},e.prototype.transform=function(a,b){return new d(function(b){return function(){return a(b.all())}}(this),b)},e.prototype.filter=function(a){return this.transform(function(b){return b.filter(a)})},e.prototype.slice=function(a,b){return this.transform(function(c){return c.slice(a,b)})},e.prototype.reduce=function(a,b){return this.all().reduce(a,null!=b?b:this.at(0))},e.prototype.reduceRight=function(a,b){return this.all().reduceRight(a,null!=b?b:this.at(0))},e.prototype.every=function(a){return this.all().every(a)},e.prototype.some=function(a){return this.all().some(a)},e.prototype.indexOf=function(a,b){return null==b&&(b=0),this.all().indexOf(a,b)},e.prototype.lastIndexOf=function(a,b){return null==b&&(b=this.length()-1),this.all().lastIndexOf(a,b)},e.prototype.join=function(a){return null==a&&(a=","),this.all().join(a)},e.prototype.first=function(){return this.at(0)},e.prototype.last=function(){return this.at(this.length()-1)},e.prototype.indexed=function(){return null==this._indexed&&(this._indexed=new j,N.autoSub(this.onChangeCells,function(a){return function(b){var c,d,e;return d=b[0],e=b[1],c=b[2],a._indexed.realSpliceCells(d,e.length,c)}}(this))),this._indexed},e.prototype.concat=function(){var a;return a=1<=arguments.length?b.call(arguments,0):[],N.concat.apply(N,[this].concat(b.call(a)))},e.prototype.realSpliceCells=function(a,b,c){var d,e,f;return e=this._cells.splice.apply(this._cells,[a,b].concat(c)),f=N.snap(function(){var a,b,c,d;for(c=[],a=0,b=e.length;a<b;a++)d=e[a],c.push(d.get());return c}),d=N.snap(function(){var a,b,d,e;for(d=[],a=0,b=c.length;a<b;a++)e=c[a],d.push(e.get());return d}),N.transaction(function(b){return function(){return b.onChangeCells.pub([a,e,c]),b.onChange.pub([a,f,d])}}(this))},e.prototype.realSplice=function(a,b,c){return this.realSpliceCells(a,b,c.map(N.cell))},e.prototype._update=function(a,b){var c,d,e,f,g,h,i,j,k,l,m;for(null==b&&(b=this.diff),i=N.snap(function(a){return function(){var b,c,d,e,f;for(d=a._cells,e=[],b=0,c=d.length;b<c;b++)f=d[b],e.push(f.get());return e}}(this)),e=[0,i.length,a],null,m=null!=b&&null!=(j=K(i.length,a,b(i,a)))?j:[e],k=[],g=0,h=m.length;g<h;g++)l=m[g],f=l[0],d=l[1],c=l[2],k.push(this.realSplice(f,d,c));return k},e}(m),r=N.SrcArray=function(d){function e(){return e.__super__.constructor.apply(this,arguments)}return c(e,d),e.prototype.spliceArray=function(a,b,c){return M.mutating(function(d){return function(){return d.realSplice(a,b,c)}}(this))},e.prototype.splice=function(){var a,c,d;return d=arguments[0],c=arguments[1],a=3<=arguments.length?b.call(arguments,2):[],this.spliceArray(d,c,a)},e.prototype.insert=function(a,b){return this.splice(b,0,a)},e.prototype.remove=function(b){var c;if((c=a(this.raw()).indexOf(b))>=0)return this.removeAt(c)},e.prototype.removeAll=function(b){return N.transaction(function(c){return function(){var d,e;for(d=a(N.snap(function(){return c.all()})).indexOf(b),e=[];d>=0;)c.removeAt(d),e.push(d=a(N.snap(function(){return c.all()})).indexOf(b));return e}}(this))},e.prototype.removeAt=function(a){var b;return b=N.snap(function(b){return function(){return b.at(a)}}(this)),this.splice(a,1),b},e.prototype.push=function(a){return this.splice(N.snap(function(a){return function(){return a.length()}}(this)),0,a)},e.prototype.pop=function(){return this.removeAt(N.snap(function(a){return function(){return a.length()-1}}(this)))},e.prototype.put=function(a,b){return this.splice(a,1,b)},e.prototype.replace=function(a){return this.spliceArray(0,N.snap(function(a){return function(){return a.length()}}(this)),a)},e.prototype.unshift=function(a){return this.insert(a,0)},e.prototype.shift=function(){return this.removeAt(0)},e.prototype.update=function(a){return M.mutating(function(b){return function(){return b._update(a)}}(this))},e.prototype.move=function(a,b){return N.transaction(function(c){return function(){var d,e;if(a!==b){if(d=N.snap(function(){return c.length()}),a<0||a>d-1)throw"Source "+a+" is outside of bounds of array of length "+d;if(b<0||b>d)throw"Destination "+b+" is outside of bounds of array of length "+d;e=N.snap(function(){return c.all()[a]}),a>b?(c.removeAt(a),c.insert(e,b)):(c.insert(e,b),c.removeAt(a))}}}(this))},e.prototype.swap=function(a,b){return N.transaction(function(c){return function(){var d,e,f;if(e=N.snap(function(){return c.length()}),a<0||a>e-1)throw"i1 "+a+" is outside of bounds of array of length "+e;if(b<0||b>e-1)throw"i2 "+b+" is outside of bounds of array of length "+e;return d=Math.min(a,b),f=Math.max(a,b),c.move(d,f),c.move(f,d)}}(this))},e.prototype.reverse=function(){return this.update(N.snap(function(a){return function(){return a.all().reverse()}}(this))),N.snap(function(a){return function(){return a.all()}}(this))},e}(l),k=N.MappedDepArray=function(a){function b(){b.__super__.constructor.call(this)}return c(b,a),b}(l),j=N.IndexedDepArray=function(d){function e(b,c){var d,f;null==b&&(b=[]),e.__super__.constructor.call(this,b,c),this.is=function(){var a,b,c,e;for(c=this._cells,e=[],d=a=0,b=c.length;a<b;d=++a)f=c[d],e.push(N.cell(d));return e}.call(this),this.onChangeCells=this._mkEv(function(b){return function(){return[0,[],a.zip(b._cells,b.is)]}}(this)),this.onChange=this._mkEv(function(b){return function(){return[0,[],a.zip(b.is,N.snap(function(){return b.all()}))]}}(this))}return c(e,d),e.prototype.map=function(a){var b;return b=new k,N.autoSub(this.onChangeCells,function(c){return function(c){var d,e,f,g,h,i,j,k,l,m;for(g=c[0],m=c[1],d=c[2],l=b._cells.slice(g,g+m.length),i=0,j=l.length;i<j;i++)e=l[i],e.disconnect();return k=function(){var b,c,g,i;for(i=[],b=0,c=d.length;b<c;b++)g=d[b],h=g[0],f=g[1],i.push(e=y(function(){return a(h.get(),f)}));return i}(),b.realSpliceCells(g,m.length,k)}}()),b},e.prototype.realSpliceCells=function(c,d,e){var f,g,h,i,j,k,l,m,n,o;for(n=this._cells.splice.apply(this._cells,[c,d].concat(e)),o=N.snap(function(){var a,b,c,d;for(c=[],a=0,b=n.length;a<b;a++)d=n[a],c.push(d.get());return c}),l=this.is.slice(c+d),k=h=0,i=l.length;h<i;k=++h)g=l[k],g.set(c+e.length+k);return j=function(){var a,b,d;for(d=[],g=a=0,b=e.length;0<=b?a<b:a>b;g=0<=b?++a:--a)d.push(N.cell(c+g));return d}(),(m=this.is).splice.apply(m,[c,d].concat(b.call(j))),f=N.snap(function(){var a,b,c,d;for(c=[],a=0,b=e.length;a<b;a++)d=e[a],c.push(d.get());return c}),N.transaction(function(b){return function(){return b.onChangeCells.pub([c,n,a.zip(e,j)]),b.onChange.pub([c,o,a.zip(f,j)])}}(this))},e}(l),N.IndexedMappedDepArray=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b}(j),d=N.DepArray=function(a){function b(a,c){this.f=a,b.__super__.constructor.call(this,[],c),N.autoSub(y(function(a){return function(){return Array.from(a.f())}}(this)).onSet,function(a){return function(b){var c;return b[0],c=b[1],a._update(c)}}(this))}return c(b,a),b}(l),N.IndexedArray=function(a){function b(a){this._cells=a}return c(b,a),b.prototype.map=function(a){var b;return b=new k,N.autoSub(this._cells.onChange,function(c){var d,e,f;return e=c[0],f=c[1],d=c[2],b.realSplice(e,f.length,d.map(a))}),b},b}(d),N.concat=function(){var a,c,d,e,f;return e=1<=arguments.length?b.call(arguments,0):[],f=new k,a=e.map(function(a){return N.cast(a,"array")}),c=function(){var a,b,c;for(c=[],a=0,b=e.length;a<b;a++)d=e[a],c.push(0);return c}(),a.forEach(function(a,b){return N.autoSub(a.onChange,function(a){var d,e,g,h;return e=a[0],g=a[1],d=a[2],h=O(c.slice(0,b)),c[b]+=d.length-g.length,f.realSplice(h+e,g.length,d)})}),f},I=function(b){return b instanceof Map?b:a.isArray(b)?new Map(b):new Map(a.pairs(b))},o=N.ObsMap=function(b){function d(a){this._base=null!=a?a:new Map,d.__super__.constructor.call(this),this._base=I(this._base),this.onAdd=this._mkEv(function(a){return function(){return new Map(a._base)}}(this)),this.onRemove=this._mkEv(function(a){return function(){return new Map}}()),this.onChange=this._mkEv(function(a){return function(){return new Map}}())}return c(d,b),d.prototype.get=function(a){return this.subAll(function(b){return b.has(a)}),this._base.get(a)},d.prototype.has=function(a){return M.sub(this.onAdd,function(b){return b.has(a)}),M.sub(this.onRemove,function(b){return b.has(a)}),this._base.has(a)},d.prototype.all=function(){return this.subAll(),new Map(this._base)},d.prototype.readonly=function(){return new f(function(a){return function(){return a.all()}}(this))},d.prototype.size=function(){return M.sub(this.onRemove),M.sub(this.onAdd),this._base.size},d.prototype.realPut=function(a,b){var c;return this._base.has(a)?(c=this._base.get(a),c!==b&&(this._base.set(a,b),this.onChange.pub(new Map([[a,[c,b]]]))),c):(this._base.set(a,b),void this.onAdd.pub(new Map([[a,b]])))},d.prototype.realRemove=function(a){var b;return b=D(this._base,a),this.onRemove.pub(new Map([[a,b]])),b},d.prototype._update=function(b){var c,d,e,f,g;return e=I(b),g=new Map(this._base),f=function(b){return function(){return a.chain(Array.from(b._base.keys())).difference(Array.from(e.keys())).map(function(a){return[a,D(b._base,a)]}).value()}}(this)(),c=function(b){return function(){return a.chain(Array.from(e.keys())).difference(Array.from(b._base.keys())).map(function(a){var c;return c=e.get(a),b._base.set(a,c),[a,c]}).value()}}(this)(),d=function(b){return function(){return a.chain(Array.from(e)).filter(function(a){var c,d;return c=a[0],d=a[1],b._base.has(c)&&b._base.get(c)!==d}).map(function(a){var c,d,e;return c=a[0],e=a[1],d=b._base.get(c),b._base.set(c,e),[c,[d,e]]}).value()}}(this)(),N.transaction(function(a){return function(){if(f.length&&a.onRemove.pub(new Map(f)),c.length&&a.onAdd.pub(new Map(c)),d.length)return a.onChange.pub(new Map(d))}}(this)),g},d}(m),t=N.SrcMap=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.put=function(a,b){return M.mutating(function(c){return function(){return c.realPut(a,b)}}(this))},b.prototype.set=function(a,b){return this.put(a,b)},b.prototype.delete=function(a){return M.mutating(function(b){return function(){var c;return c=void 0,b._base.has(a)&&(c=b.realRemove(a),b.onRemove.pub(new Map([[a,c]]))),c}}(this))},b.prototype.remove=function(a){return this.delete(a)},b.prototype.clear=function(){return M.mutating(function(a){return function(){var b;return b=new Map(a._base),a._base.clear(),b.size&&a.onRemove.pub(b),b}}(this))},b.prototype.update=function(a){return M.mutating(function(b){return function(){return b._update(a)}}(this))},b}(o),f=N.DepMap=function(a){function b(a){var c;this.f=a,b.__super__.constructor.call(this),c=y(this.f),N.autoSub(c.onSet,function(a){return function(b){var c;return b[0],c=b[1],a._update(c)}}(this))}return c(b,a),b}(o),J=function(a){return a instanceof Set?a:new Set(a)},v=function(a){return a instanceof Set||a instanceof p&&(a=a.all()),a instanceof l&&(a=a.all()),a instanceof n&&(a=a.get()),new Set(a)},p=N.ObsSet=function(a){function b(a){this._base=null!=a?a:new Set,b.__super__.constructor.call(this),this._base=J(this._base),this.onChange=this._mkEv(function(a){return function(){return[a._base,new Set]}}(this))}return c(b,a),b.prototype.has=function(a){return this.subAll(function(b){var c,d;return c=b[0],d=b[1],c.has(a)||d.has(a)}),this._base.has(a)},b.prototype.all=function(){return this.subAll(),new Set(this._base)},b.prototype.readonly=function(){return new h(function(a){return function(){return a.all()}}(this))},b.prototype.values=function(){return this.all()},b.prototype.entries=function(){return this.all()},b.prototype.size=function(){return this.subAll(function(a){var b,c;return b=a[0],c=a[1],b.size!==c.size}),this._base.size},b.prototype.union=function(a){return new h(function(b){return function(){return P(b.all(),v(a))}}(this))},b.prototype.intersection=function(a){return new h(function(b){return function(){return C(b.all(),v(a))}}(this))},b.prototype.difference=function(a){return new h(function(b){return function(){return A(b.all(),v(a))}}(this))},b.prototype.symmetricDifference=function(a){return new h(function(b){return function(){var c;return c=b.all(),a=v(a),new Set(Array.from(P(c,a)).filter(function(b){return!c.has(b)||!a.has(b)}))}}(this))},b.prototype._update=function(a){return N.transaction(function(b){return function(){var c,d,e,f;return e=new Set(b._base),d=J(a),c=new Set,f=new Set,e.forEach(function(a){if(!d.has(a))return f.add(a)}),d.forEach(function(a){if(!e.has(a))return c.add(a)}),e.forEach(function(a){return b._base.delete(a)}),d.forEach(function(a){return b._base.add(a)}),b.onChange.pub([c,f]),e}}(this))},b}(m),u=N.SrcSet=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.add=function(a){return M.mutating(function(b){return function(){return b._base.has(a)||(b._base.add(a),b.onChange.pub([new Set([a]),new Set])),a}}(this))},b.prototype.put=function(a){return this.add(a)},b.prototype.delete=function(a){return M.mutating(function(b){return function(){return b._base.has(a)&&(b._base.delete(a),b.onChange.pub([new Set,new Set([a])])),a}}(this))},b.prototype.remove=function(a){return this.delete(a)},b.prototype.clear=function(){return M.mutating(function(a){return function(){var b;return b=new Set(a._base),a._base.size&&(a._base.clear(),a.onChange.pub([new Set,b])),b}}(this))},b.prototype.update=function(a){return M.mutating(function(b){return function(){return b._update(a)}}(this))},b}(p),h=N.DepSet=function(a){function b(a){var c;this.f=a,b.__super__.constructor.call(this),c=y(this.f),N.autoSub(c.onSet,function(a){return function(b){var c;return b[0],c=b[1],a._update(c)}}(this))}return c(b,a),b}(p),N.cellToSet=function(a){return new N.DepSet(function(){return a.get()})},N.liftSpec=function(b){var c,d,e;return a.object(function(){var f,g,h,i;for(h=Object.getOwnPropertyNames(b),i=[],f=0,g=h.length;f<g;f++)c=h[f],null!=(e=b[c])&&[N.ObsMap,N.ObsCell,N.ObsArray,N.ObsSet].some(function(a){return e instanceof a})||(d=a.isFunction(e)?null:a.isArray(e)?"array":e instanceof Set?"set":e instanceof Map?"map":"cell",i.push([c,{type:d,val:e}]));return i}())},N.lift=function(b,c){return null==c&&(c=N.liftSpec(b)),a.mapObject(c,function(a,c){var d;return d=a.type,!(b[c]instanceof m)&&d in N.types?N[d](b[c]):b[c]})},N.unlift=function(b){return a.mapObject(b,function(a){return a instanceof N.ObsBase?a.all():a})},N.reactify=function(c,d){var e,f,g,h;return a.isArray(c)?(e=N.array(a.clone(c)),Object.defineProperties(c,a.object(function(){var d,g,h,i;for(h=a.functions(e),i=[],d=0,g=h.length;d<g;d++)"length"!==(f=h[d])&&i.push(function(a){var d,f,g;return d=c[a],f=function(){var f,g,h;return f=1<=arguments.length?b.call(arguments,0):[],null!=d&&(h=d.call.apply(d,[c].concat(b.call(f)))),(g=e[a]).call.apply(g,[e].concat(b.call(f))),h},g={configurable:!0,enumerable:!1,value:f,writable:!0},[a,g]}(f));return i}())),c):Object.defineProperties(c,a.object(function(){var a;a=[];for(g in d)h=d[g],a.push(function(a,c){var d,e,f,g,h;switch(d=null,c.type){case"cell":e=N.cell(null!=(f=c.val)?f:null),d={configurable:!0,enumerable:!0,get:function(){return e.get()},set:function(a){return e.set(a)}};break;case"array":h=N.reactify(null!=(g=c.val)?g:[]),d={configurable:!0,enumerable:!0,get:function(){return h.all(),h},set:function(a){return h.splice.apply(h,[0,h.length].concat(b.call(a))),h}};break;default:throw new Error("Unknown observable type: "+type)}return[a,d]}(g,h));return a}()))},N.autoReactify=function(b){var c,d,e;return N.reactify(b,a.object(function(){var f,g,h,i;for(h=Object.getOwnPropertyNames(b),i=[],f=0,g=h.length;f<g;f++)c=h[f],(e=b[c])instanceof o||e instanceof n||e instanceof l||(d=a.isFunction(e)?null:a.isArray(e)?"array":"cell",i.push([c,{type:d,val:e}]));return i}()))},N.cell=function(a){return new s(a)},N.cell.from=function(a){return a instanceof n?a:y(a instanceof m?function(){return a.all()}:function(){return a})},N.array=function(a,b){return new r((null!=a?a:[]).map(N.cell),b)},N.array.from=function(b,c){var e;if(b instanceof N.ObsArray)return b;if(a.isArray(b))e=function(){return b};else{if(!(b instanceof m))throw new Error("Cannot cast "+b.constructor.name+" to array!");e=function(){return b.all()}}return new d(e,c)},N.map=function(a){return new t(a)},N.map.from=function(a){return a instanceof N.ObsMap?a:new f(a instanceof m?function(){return a.get()}:function(){return a})},N.set=function(a){return new u(a)},N.set.from=function(a){return a instanceof N.ObsSet?a:new h(a instanceof N.ObsBase?function(){return a.all()}:function(){return a})},N.cast=function(b,c){var d,e,f;if(null==c&&(c="cell"),c===n||c===l||c===o||c===p){switch(e=null,c){case n:e="cell";break;case l:e="array";break;case o:e="map";break;case p:e="set"}c=e}return a.isString(c)?c in N.types?N[c].from(b):b:(d=b,f=c,a.mapObject(d,function(a,b){return f[b]?N.cast(a,f[b]):a}))},N.flatten=function(b){return new d(function(){return a.chain(B([b])).flatten().filter(function(a){return null!=a}).value()})},B=function(b){return b instanceof l?B(b.all()):b instanceof p?B(Array.from(b.values())):b instanceof n?B(b.get()):b instanceof Set?B(Array.from(b)):a.isArray(b)?b.map(function(a){return B(a)}):b},function(b){return a.flatten(b),N.cellToArray(y(function(){return a.flatten(b)}))},N.cellToArray=function(a,b){return new d(function(){return a.get()},b)},N.cellToMap=function(a){return new N.DepMap(function(){return a.get()})},N.cellToSet=function(a){return new N.DepSet(function(){return a.get()})},N.basicDiff=function(a){return null==a&&(a=N.smartUidify),function(b,c){var d,e,f,g,h,i,j;for(g=E(function(){var c,e,f;for(f=[],d=c=0,e=b.length;c<e;d=++c)j=b[d],f.push([a(j),d]);return f}()),i=[],e=0,f=c.length;e<f;e++)j=c[e],i.push(null!=(h=g[a(j)])?h:-1);return i}},N.uidify=function(a){var b;return null!=(b=a.__rxUid)?b:Object.defineProperty(a,"__rxUid",{enumerable:!1,value:F()}).__rxUid},N.smartUidify=function(b){return a.isObject(b)?N.uidify(b):JSON.stringify(b)},K=function(b,c,d){var e,f,g,h,i,j;if(!c.length)return null;if(h=function(){var a,b,c;for(c=[],a=0,b=d.length;a<b;a++)(f=d[a])>=0&&c.push(f);return c}(),a.some(function(){var a,b,c;for(c=[],f=a=0,b=h.length-1;0<=b?a<b:a>b;f=0<=b?++a:--a)c.push(h[f+1]-h[f]<=0);return c}()))return null;for(j=[],g=-1,f=0;f<d.length;){for(;f<d.length&&d[f]===g+1;)g+=1,f+=1;for(i={index:f,count:0,additions:[]};f<d.length&&-1===d[f];)i.additions.push(c[f]),f+=1;e=f===d.length?b:d[f],i.count=e-(g+1),(i.count>0||i.additions.length>0)&&j.push([i.index,i.count,i.additions]),g=e,f+=1}return j},N.transaction=function(a){return z.transaction(a)},N},function(a,b){var c,d,e;if(d=["underscore"],null!=("undefined"!=typeof define&&null!==define?define.amd:void 0))return define(d,b);if(null!=("undefined"!=typeof module&&null!==module?module.exports:void 0))return c=require("underscore"),e=b(c),module.exports=e;if(null!=a._)return a.rx=b(a._);throw"Dependencies are not met for bobtail-core: _ not found"}(this,a)}).call(this);
//# sourceMappingURL=reactive-coffee.min.js.map