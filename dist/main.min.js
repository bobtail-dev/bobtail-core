!function(n,t){if("function"==typeof define&&define.amd)define("bobtail-rx",["exports","underscore"],t);else if("undefined"!=typeof exports)t(exports,require("underscore"));else{var r={exports:{}};t(r.exports,n._),n.rx=r.exports}}(this,function(n,t){"use strict";function r(n,t){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?n:t}function e(n,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(n,t):n.__proto__=t)}function u(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}function i(n){if(Array.isArray(n)){for(var t=0,r=Array(n.length);t<n.length;t++)r[t]=n[t];return r}return Array.from(n)}Object.defineProperty(n,"__esModule",{value:!0}),n.transaction=n.smartUidify=n.uidify=n.basicDiff=n.cellToSet=n.cellToMap=n.cellToArray=n.flatten=n.cast=n.set=n.map=n.array=n.cell=n.autoReactify=n.reactify=n.unlift=n.lift=n.liftSpec=n.DepSet=n.SrcSet=n.ObsSet=n.DepMap=n.SrcMap=n.ObsMap=n.concat=n.IndexedArray=n.DepArray=n.IndexedDepArray=n.MappedDepArray=n.SrcArray=n.ObsArray=n.DepCell=n.SrcCell=n.ObsCell=n.ObsBase=n.subOnce=n.autoSub=n.onDispose=n.snap=n.postLagBind=n.lagBind=n.bind=n.promiseBind=n.asyncBind=n.hideMutationWarnings=n._recorder=n.types=n.allDownstream=n.upstream=n.skipFirst=n.Ev=n._depMgr=n.DepMgr=void 0;var a=function(n){return n&&n.__esModule?n:{default:n}}(t),o=function(){function n(n,t){for(var r=0;r<t.length;r++){var e=t[r];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(n,e.key,e)}}return function(t,r,e){return r&&n(t.prototype,r),e&&n(t,e),t}}(),l=function(){function n(n,t){var r=[],e=!0,u=!1,i=void 0;try{for(var a,o=n[Symbol.iterator]();!(e=(a=o.next()).done)&&(r.push(a.value),!t||r.length!==t);e=!0);}catch(n){u=!0,i=n}finally{try{!e&&o.return&&o.return()}finally{if(u)throw i}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return n(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),f=0,s=function(){return f+=1},c=function(n,t){return new Set([].concat(i(Array.from(n)),i(Array.from(t))))},h=function(n,t){return new Set(Array.from(n).filter(function(n){return t.has(n)}))},v=function(n,t){return new Set(Array.from(n).filter(function(n){return!t.has(n)}))},y=function(n,t){if(!(t in n))throw new Error("object has no key "+t);var r=n[t];return delete n[t],r},d=function(n,t){var r=n.get(t);return n.delete(t),r},p=function(n){var t=void 0,r=void 0;null==n&&(n=[]);var e=null!=Object.create?Object.create(null):{};if(a.default.isArray(n)){var u=!0,i=!1,o=void 0;try{for(var f,s=n[Symbol.iterator]();!(u=(f=s.next()).done);u=!0){var c=l(f.value,2);t=c[0],r=c[1],e[t]=r}}catch(n){i=!0,o=n}finally{try{!u&&s.return&&s.return()}finally{if(i)throw o}}}else for(t in n)r=n[t],e[t]=r;return e},g=function(n){var t=0,r=!0,e=!1,u=void 0;try{for(var i,a=Array.from(n)[Symbol.iterator]();!(r=(i=a.next()).done);r=!0)t+=i.value}catch(n){e=!0,u=n}finally{try{!r&&a.return&&a.return()}finally{if(e)throw u}}return t},m=n.DepMgr=function(){function n(){u(this,n),this.buffering=0,this.buffer=[],this.events=new Set}return o(n,[{key:"transaction",value:function(n){var t=void 0;this.buffering+=1;try{t=n()}finally{if(this.buffering-=1,0===this.buffering){var r=new Set(a.default.flatten(Array.from(this.events).map(function(n){var t=n.downstreamCells;return Array.from(t)}))),e=A.apply(void 0,i(Array.from(r||[])));e.forEach(function(n){return n._shield=!0});try{var u=this.buffer;this.buffer=[],this.events.clear(),u.map(function(){var n=Array.from(arguments.length<=0?void 0:arguments[0]),t=l(n,2),r=t[0],e=t[1];return r.pub(e)}),e.forEach(function(n){return n.refresh()})}finally{e.forEach(function(n){return n._shield=!1})}}}return t}}]),n}(),b=n._depMgr=new m,_=n.Ev=function(){function n(t,r){u(this,n),this.observable=r,this.init=t,this.subs=p(),this.downstreamCells=new Set}return o(n,[{key:"sub",value:function(n){var t=s();return null!=this.init&&n(this.init()),this.subs[t]=n,t}},{key:"pub",value:function(n){var t=this;return b.buffering?(b.buffer.push([this,n]),b.events.add(this)):function(){var r=[];for(var e in t.subs){var u=t.subs[e];r.push(u(n))}return r}()}},{key:"unsub",value:function(n){return y(this.subs,n)}},{key:"scoped",value:function(n,t){var r=this.sub(n);try{return t()}finally{this.unsub(r)}}}]),n}(),k=n.skipFirst=function(n){var t=!0;return function(){if(t)return t=!1;for(var r=arguments.length,e=Array(r),u=0;u<r;u++)e[u]=arguments[u];return n.apply(void 0,i(Array.from(e||[])))}},w=(n.upstream=function(n){var t=Array.from(n.upstreamEvents).map(function(n){return n.observable});return Array.from(new Set(t))},function n(){for(var t=arguments.length,r=Array(t),e=0;e<t;e++)r[e]=arguments[e];if(r.length){var u=Array.from(new Set(a.default.flatten(r.map(function(n){return Array.from(n.onSet.downstreamCells)}))));return a.default.flatten([u,n.apply(void 0,i(Array.from(u||[])))])}return[]}),A=n.allDownstream=function(){for(var n=arguments.length,t=Array(n),r=0;r<n;r++)t[r]=arguments[r];return Array.from(new Set([].concat(i(Array.from(t)),i(Array.from(w.apply(void 0,i(Array.from(t||[])))))).reverse())).reverse()},S=function(){function n(){u(this,n),this.stack=[],this.isMutating=!1,this.isIgnoring=!1,this.hidingMutationWarnings=!1,this.onMutationWarning=new _}return o(n,[{key:"record",value:function(n,t){this.stack.length>0&&!this.isMutating&&(0,a.default)(this.stack).last().addNestedBind(n),this.stack.push(n);var r=this.isMutating;this.isMutating=!1;var e=this.isIgnoring;this.isIgnoring=!1;try{return t()}finally{this.isIgnoring=e,this.isMutating=r,this.stack.pop()}}},{key:"sub",value:function(n,t){if(null==t&&(t=function(){return!0}),this.stack.length>0&&!this.isIgnoring){var r=(0,a.default)(this.stack).last();return r.upstreamEvents.add(n),n.downstreamCells.add(r),P(n,function(){for(var n=arguments.length,e=Array(n),u=0;u<n;u++)e[u]=arguments[u];if(t.apply(void 0,i(Array.from(e||[]))))return r.refresh()})}}},{key:"addCleanup",value:function(n){if(this.stack.length>0)return(0,a.default)(this.stack).last().addCleanup(n)}},{key:"hideMutationWarnings",value:function(n){var t=this.hidingMutationWarnings;this.hidingMutationWarnings=!0;try{return n()}finally{this.hidingMutationWarnings=t}}},{key:"fireMutationWarning",value:function(){return console.warn("Mutation to observable detected during a bind context"),this.onMutationWarning.pub(null)}},{key:"mutating",value:function(n){this.stack.length>0&&!this.hidingMutationWarnings&&this.fireMutationWarning();var t=this.isMutating;this.isMutating=!0;try{return n()}finally{this.isMutating=t}}},{key:"ignoring",value:function(n){var t=this.isIgnoring;this.isIgnoring=!0;try{return n()}finally{this.isIgnoring=t}}}]),n}(),O=n.types={cell:"cell",array:"array",map:"map",set:"set"},C=n._recorder=new S,M=(n.hideMutationWarnings=function(n){return C.hideMutationWarnings(n)},n.asyncBind=function(n,t){var r=new z(t,n);return r.refresh(),r}),x=(n.promiseBind=function(n,t){return M(n,function(){var n=this;return this.record(t).done(function(t){return n.done(t)})})},n.bind=function(n){return M(null,function(){return this.done(this.record(n))})}),j=(n.lagBind=function(n,t,r){var e=null;return M(t,function(){var t=this;return null!=e&&clearTimeout(e),e=setTimeout(function(){return t.done(t.record(r))},n)})},n.postLagBind=function(n,t){var r=null;return M(n,function(){var n=this,e=this.record(t),u=e.val,i=e.ms;return null!=r&&clearTimeout(r),r=setTimeout(function(){return n.done(u)},i)})},n.snap=function(n){return C.ignoring(n)}),E=n.onDispose=function(n){return C.addCleanup(n)},P=n.autoSub=function(n,t){var r=n.sub(t);return E(function(){return n.unsub(r)}),r},D=(n.subOnce=function(n,t){var r=P(n,k.apply(void 0,i(function(e){return a.default.defer(function(){return t.apply(void 0,i(e))}),n.unsub(r)})));return r},function(){function n(){u(this,n),this.events=[]}return o(n,[{key:"flatten",value:function(){return an(this)}},{key:"subAll",value:function(n){return null==n&&(n=function(){return!0}),this.events.forEach(function(t){return C.sub(t,n)})}},{key:"raw",value:function(){return this._base}},{key:"_mkEv",value:function(n){var t=new _(n,this);return this.events.push(t),t}}]),n}());D.prototype.to={cell:function(){return $.from(void 0)},array:function(){return nn.from(void 0)},map:function(){return tn.from(void 0)},set:function(){return rn.from(void 0)}},n.ObsBase=D;var B=n.ObsCell=function(n){function t(n){u(this,t);var e=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));e._base=null!=n?n:null,e.onSet=e._mkEv(function(){return[null,e._base]}),e._shield=!1;var a=function(){return e.onSet.downstreamCells};return e.refreshAll=function(){if(e.onSet.downstreamCells.size&&!e._shield){e._shield=!0;var n=A.apply(void 0,i(Array.from(Array.from(a())||[])));n.forEach(function(n){return n._shield=!0});try{return n.forEach(function(n){return n.refresh()})}finally{n.forEach(function(n){return n._shield=!1}),e._shield=!1}}},e.refreshSub=P(e.onSet,e.refreshAll),e}return e(t,D),o(t,[{key:"all",value:function(){var n=this;return this.subAll(function(){return!n._shield}),this._base}},{key:"get",value:function(){return this.all()}},{key:"readonly",value:function(){var n=this;return new z(function(){return n.all()})}}]),t}(),I=n.SrcCell=function(n){function t(){return u(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return e(t,B),o(t,[{key:"set",value:function(n){var t=this;return C.mutating(function(){if(t._base!==n){var r=t._base;return t._base=n,t.onSet.pub([r,n]),r}})}}]),t}(),z=n.DepCell=function(n){function t(n,e){u(this,t);var i=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,null!=e?e:null));return i.body=null!=n?n:null,i.refreshing=!1,i.nestedBinds=[],i.cleanups=[],i.upstreamEvents=new Set,i}return e(t,B),o(t,[{key:"refresh",value:function(){var n=this;if(!this.refreshing){var t=this._base,r=function(r){return n._base=r,n.onSet.pub([t,n._base])},e=!1,u=null,i=!1,a={record:function(t){if(!n.refreshing){var o=void 0;if(n.disconnect(),e)throw new Error("this refresh has already recorded its dependencies");n.refreshing=!0,e=!0;try{o=C.record(n,function(){return t.call(a)})}finally{n.refreshing=!1}return i&&r(u),o}},done:function(e){if(t!==e)return n.refreshing?(i=!0,u=e):r(e)}};return this.body.call(a)}}},{key:"disconnect",value:function(){var n=this,t=!0,r=!1,e=void 0;try{for(var u,i=Array.from(this.cleanups)[Symbol.iterator]();!(t=(u=i.next()).done);t=!0)(0,u.value)()}catch(n){r=!0,e=n}finally{try{!t&&i.return&&i.return()}finally{if(r)throw e}}var a=!0,o=!1,l=void 0;try{for(var f,s=Array.from(this.nestedBinds)[Symbol.iterator]();!(a=(f=s.next()).done);a=!0)f.value.disconnect()}catch(n){o=!0,l=n}finally{try{!a&&s.return&&s.return()}finally{if(o)throw l}}return this.nestedBinds=[],this.cleanups=[],this.upstreamEvents.forEach(function(t){return t.downstreamCells.delete(n)}),this.upstreamEvents.clear()}},{key:"addNestedBind",value:function(n){return this.nestedBinds.push(n)}},{key:"addCleanup",value:function(n){return this.cleanups.push(n)}}]),t}(),R=n.ObsArray=function(n){function t(n,e){u(this,t),null==n&&(n=[]),null==e&&(e=ln());var i=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i._cells=n,i.diff=e,i.onChange=i._mkEv(function(){return[0,[],i._cells.map(function(n){return n.raw()})]}),i.onChangeCells=i._mkEv(function(){return[0,[],i._cells]}),i._indexed=null,i}return e(t,D),o(t,[{key:"all",value:function(){return C.sub(this.onChange),this._cells.map(function(n){return n.get()})}},{key:"raw",value:function(){return this._cells.map(function(n){return n.raw()})}},{key:"readonly",value:function(){var n=this;return new U(function(){return n.all()})}},{key:"rawCells",value:function(){return this._cells}},{key:"at",value:function(n){return C.sub(this.onChange,function(){var t=Array.from(arguments.length<=0?void 0:arguments[0]),r=l(t,3),e=r[0],u=r[1],i=r[2];return e<=n&&u.length!==i.length||u.length===i.length&&n<=e+u.length}),null!=this._cells[n]?this._cells[n].get():void 0}},{key:"length",value:function(){return C.sub(this.onChangeCells,function(){var n=Array.from(arguments.length<=0?void 0:arguments[0]),t=l(n,3),r=(t[0],t[1]),e=t[2];return r.length!==e.length}),this._cells.length}},{key:"size",value:function(){return this.length()}},{key:"map",value:function(n){var t=new W;return P(this.onChangeCells,function(){var r=Array.from(arguments.length<=0?void 0:arguments[0]),e=l(r,3),u=e[0],i=e[1],a=e[2],o=!0,f=!1,s=void 0;try{for(var c,h=Array.from(t._cells.slice(u,u+i.length))[Symbol.iterator]();!(o=(c=h.next()).done);o=!0){var v=c.value;v.disconnect()}}catch(n){f=!0,s=n}finally{try{!o&&h.return&&h.return()}finally{if(f)throw s}}var y=a.map(function(t){return v=x(function(){return n(t.get())})});return t.realSpliceCells(u,i.length,y)}),t}},{key:"transform",value:function(n,t){var r=this;return new U(function(){return n(r.all())},t)}},{key:"filter",value:function(n){return this.transform(function(t){return t.filter(n)})}},{key:"slice",value:function(n,t){return this.transform(function(r){return r.slice(n,t)})}},{key:"reduce",value:function(n,t){return this.all().reduce(n,null!=t?t:this.at(0))}},{key:"reduceRight",value:function(n,t){return this.all().reduceRight(n,null!=t?t:this.at(0))}},{key:"every",value:function(n){return this.all().every(n)}},{key:"some",value:function(n){return this.all().some(n)}},{key:"indexOf",value:function(n,t){return null==t&&(t=0),this.all().indexOf(n,t)}},{key:"lastIndexOf",value:function(n,t){return null==t&&(t=this.length()-1),this.all().lastIndexOf(n,t)}},{key:"join",value:function(n){return null==n&&(n=","),this.all().join(n)}},{key:"first",value:function(){return this.at(0)}},{key:"last",value:function(){return this.at(this.length()-1)}},{key:"indexed",value:function(){var n=this;return null==this._indexed&&(this._indexed=new N,P(this.onChangeCells,function(){var t=Array.from(arguments.length<=0?void 0:arguments[0]),r=l(t,3),e=r[0],u=r[1],i=r[2];return n._indexed.realSpliceCells(e,u.length,i)})),this._indexed}},{key:"concat",value:function(){for(var n=arguments.length,t=Array(n),r=0;r<n;r++)t[r]=arguments[r];return F.apply(void 0,[this].concat(i(Array.from(t))))}},{key:"realSpliceCells",value:function(n,t,r){var e=this,u=this._cells.splice.apply(this._cells,[n,t].concat(r)),i=j(function(){return Array.from(u).map(function(n){return n.get()})}),a=j(function(){return Array.from(r).map(function(n){return n.get()})});return hn(function(){return e.onChangeCells.pub([n,u,r]),e.onChange.pub([n,i,a])})}},{key:"realSplice",value:function(n,t,r){return this.realSpliceCells(n,t,r.map($))}},{key:"_update",value:function(n,t){var r=this,e=void 0;null==t&&(t=this.diff);var u=j(function(){return Array.from(r._cells).map(function(n){return n.get()})}),i=[0,u.length,n],a=null!=t&&null!=(e=cn(u.length,n,t(u,n)))?e:[i];return function(){var n=[],t=!0,e=!1,u=void 0;try{for(var i,o=Array.from(a)[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var f=i.value,s=Array.from(f),c=l(s,3),h=c[0],v=c[1],y=c[2];n.push(r.realSplice(h,v,y))}}catch(n){e=!0,u=n}finally{try{!t&&o.return&&o.return()}finally{if(e)throw u}}return n}()}}]),t}(),T=n.SrcArray=function(n){function t(){return u(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return e(t,R),o(t,[{key:"spliceArray",value:function(n,t,r){var e=this;return C.mutating(function(){return e.realSplice(n,t,r)})}},{key:"splice",value:function(n,t){for(var r=arguments.length,e=Array(r>2?r-2:0),u=2;u<r;u++)e[u-2]=arguments[u];return this.spliceArray(n,t,e)}},{key:"insert",value:function(n,t){return this.splice(t,0,n)}},{key:"remove",value:function(n){var t=(0,a.default)(this.raw()).indexOf(n);if(t>=0)return this.removeAt(t)}},{key:"removeAll",value:function(n){var t=this;return hn(function(){var r=(0,a.default)(j(function(){return t.all()})).indexOf(n);return function(){for(var e=[];r>=0;)t.removeAt(r),e.push(r=(0,a.default)(j(function(){return t.all()})).indexOf(n));return e}()})}},{key:"removeAt",value:function(n){var t=this,r=j(function(){return t.at(n)});return this.splice(n,1),r}},{key:"push",value:function(n){var t=this;return this.splice(j(function(){return t.length()}),0,n)}},{key:"pop",value:function(){var n=this;return this.removeAt(j(function(){return n.length()-1}))}},{key:"put",value:function(n,t){return this.splice(n,1,t)}},{key:"replace",value:function(n){var t=this;return this.spliceArray(0,j(function(){return t.length()}),n)}},{key:"unshift",value:function(n){return this.insert(n,0)}},{key:"shift",value:function(){return this.removeAt(0)}},{key:"update",value:function(n){var t=this;return C.mutating(function(){return t._update(n)})}},{key:"move",value:function(n,t){var r=this;return hn(function(){if(n!==t){var e=j(function(){return r.length()});if(n<0||n>e-1)throw"Source "+n+" is outside of bounds of array of length "+e;if(t<0||t>e)throw"Destination "+t+" is outside of bounds of array of length "+e;var u=j(function(){return r.all()[n]});n>t?(r.removeAt(n),r.insert(u,t)):(r.insert(u,t),r.removeAt(n))}})}},{key:"swap",value:function(n,t){var r=this;return hn(function(){var e=j(function(){return r.length()});if(n<0||n>e-1)throw"i1 "+n+" is outside of bounds of array of length "+e;if(t<0||t>e-1)throw"i2 "+t+" is outside of bounds of array of length "+e;var u=Math.min(n,t),i=Math.max(n,t);return r.move(u,i),r.move(i,u)})}},{key:"reverse",value:function(){var n=this;return this.update(j(function(){return n.all().reverse()})),j(function(){return n.all()})}}]),t}(),W=n.MappedDepArray=function(n){function t(){return u(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return e(t,R),t}(),N=n.IndexedDepArray=function(n){function t(n,e){u(this,t),null==n&&(n=[]);var i=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n,e));return i.is=Array.from(i._cells).map(function(n,t){return $(t)}),i.onChangeCells=i._mkEv(function(){return[0,[],a.default.zip(i._cells,i.is)]}),i.onChange=i._mkEv(function(){return[0,[],a.default.zip(i.is,j(function(){return i.all()}))]}),i}return e(t,R),o(t,[{key:"map",value:function(n){var t=new W;return P(this.onChangeCells,function(){var r=Array.from(arguments.length<=0?void 0:arguments[0]),e=l(r,3),u=e[0],i=e[1],a=e[2],o=!0,f=!1,s=void 0;try{for(var c,h=Array.from(t._cells.slice(u,u+i.length))[Symbol.iterator]();!(o=(c=h.next()).done);o=!0){var v=c.value;v.disconnect()}}catch(n){f=!0,s=n}finally{try{!o&&h.return&&h.return()}finally{if(f)throw s}}var y=function(){var t=[],r=!0,e=!1,u=void 0;try{for(var i,o=Array.from(a)[Symbol.iterator]();!(r=(i=o.next()).done);r=!0){var f=l(i.value,2),s=f[0],c=f[1];t.push(v=x(function(){return n(s.get(),c)}))}}catch(n){e=!0,u=n}finally{try{!r&&o.return&&o.return()}finally{if(e)throw u}}return t}();return t.realSpliceCells(u,i.length,y)}),t}},{key:"realSpliceCells",value:function(n,t,r){for(var e,u=this,o=void 0,l=this._cells.splice.apply(this._cells,[n,t].concat(r)),f=j(function(){return Array.from(l).map(function(n){return n.get()})}),s=this.is.slice(n+t),c=0;c<s.length;c++)(o=s[c]).set(n+r.length+c);var h=function(){var t=void 0,e=void 0,u=[];for(o=0,t=0<=(e=r.length);t?o<e:o>e;t?o++:o--)u.push($(n+o));return u}();(e=this.is).splice.apply(e,[n,t].concat(i(Array.from(h))));var v=j(function(){return Array.from(r).map(function(n){return n.get()})});return hn(function(){return u.onChangeCells.pub([n,l,a.default.zip(r,h)]),u.onChange.pub([n,f,a.default.zip(v,h)])})}}]),t}(),U=n.DepArray=function(n){function t(n,e){u(this,t);var i=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,[],e));return i.f=n,P(x(function(){return Array.from(i.f())}).onSet,function(){var n=Array.from(arguments.length<=0?void 0:arguments[0]),t=l(n,2),r=(t[0],t[1]);return i._update(r)}),i}return e(t,R),t}(),F=(n.IndexedArray=function(n){function t(n){u(this,t);var e=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._cells=n,e}return e(t,U),o(t,[{key:"map",value:function(n){var t=new W;return P(this._cells.onChange,function(){var r=Array.from(arguments.length<=0?void 0:arguments[0]),e=l(r,3),u=e[0],i=e[1],a=e[2];return t.realSplice(u,i.length,a.map(n))}),t}}]),t}(),function(){for(var n=arguments.length,t=Array(n),r=0;r<n;r++)t[r]=arguments[r];var e=void 0,u=new W,i=t.map(function(n){return un(n,"array")}),a=function(){var n=[],r=!0,u=!1,i=void 0;try{for(var a,o=Array.from(t)[Symbol.iterator]();!(r=(a=o.next()).done);r=!0)e=a.value,n.push(0)}catch(n){u=!0,i=n}finally{try{!r&&o.return&&o.return()}finally{if(u)throw i}}return n}();return i.forEach(function(n,t){return P(n.onChange,function(){var n=Array.from(arguments.length<=0?void 0:arguments[0]),r=l(n,3),e=r[0],i=r[1],o=r[2],f=g(a.slice(0,t));return a[t]+=o.length-i.length,u.realSplice(f+e,i.length,o)})}),u});n.concat=F;var L=function(n){return n instanceof Map?n:a.default.isArray(n)?new Map(n):new Map(a.default.pairs(n))},q=n.ObsMap=function(n){function t(n){u(this,t),null==n&&(n=new Map);var e=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._base=L(n),e.onAdd=e._mkEv(function(){return new Map(e._base)}),e.onRemove=e._mkEv(function(){return new Map}),e.onChange=e._mkEv(function(){return new Map}),e}return e(t,D),o(t,[{key:"get",value:function(n){return this.subAll(function(t){return t.has(n)}),this._base.get(n)}},{key:"has",value:function(n){return C.sub(this.onAdd,function(t){return t.has(n)}),C.sub(this.onRemove,function(t){return t.has(n)}),this._base.has(n)}},{key:"all",value:function(){return this.subAll(),new Map(this._base)}},{key:"readonly",value:function(){var n=this;return new G(function(){return n.all()})}},{key:"size",value:function(){return C.sub(this.onRemove),C.sub(this.onAdd),this._base.size}},{key:"realPut",value:function(n,t){if(this._base.has(n)){var r=this._base.get(n);return r!==t&&(this._base.set(n,t),this.onChange.pub(new Map([[n,[r,t]]]))),r}return this._base.set(n,t),void this.onAdd.pub(new Map([[n,t]]))}},{key:"realRemove",value:function(n){var t=d(this._base,n);return this.onRemove.pub(new Map([[n,t]])),t}},{key:"_update",value:function(n){var t=this,r=void 0,e=L(n),u=new Map(this._base),i=a.default.chain(Array.from(t._base.keys())).difference(Array.from(e.keys())).map(function(n){return[n,d(t._base,n)]}).value(),o=a.default.chain(Array.from(e.keys())).difference(Array.from(t._base.keys())).map(function(n){return r=e.get(n),t._base.set(n,r),[n,r]}).value(),f=function(){var n=void 0;return a.default.chain(Array.from(e)).filter(function(){var e=Array.from(arguments.length<=0?void 0:arguments[0]),u=l(e,2);return n=u[0],r=u[1],t._base.has(n)&&t._base.get(n)!==r}).map(function(){var e=Array.from(arguments.length<=0?void 0:arguments[0]),u=l(e,2);n=u[0],r=u[1];var i=t._base.get(n);return t._base.set(n,r),[n,[i,r]]}).value()}();return hn(function(){if(i.length&&t.onRemove.pub(new Map(i)),o.length&&t.onAdd.pub(new Map(o)),f.length)return t.onChange.pub(new Map(f))}),u}}]),t}(),J=n.SrcMap=function(n){function t(){return u(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return e(t,q),o(t,[{key:"put",value:function(n,t){var r=this;return C.mutating(function(){return r.realPut(n,t)})}},{key:"set",value:function(n,t){return this.put(n,t)}},{key:"delete",value:function(n){var t=this;return C.mutating(function(){var r=void 0;return t._base.has(n)&&(r=t.realRemove(n),t.onRemove.pub(new Map([[n,r]]))),r})}},{key:"remove",value:function(n){return this.delete(n)}},{key:"clear",value:function(){var n=this;return C.mutating(function(){var t=new Map(n._base);return n._base.clear(),t.size&&n.onRemove.pub(t),t})}},{key:"update",value:function(n){var t=this;return C.mutating(function(){return t._update(n)})}}]),t}(),G=n.DepMap=function(n){function t(n){u(this,t);var e=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));e.f=n;var i=x(e.f);return P(i.onSet,function(){var n=Array.from(arguments.length<=0?void 0:arguments[0]),t=l(n,2),r=(t[0],t[1]);return e._update(r)}),e}return e(t,q),t}(),H=function(n){return n instanceof Set?n:new Set(n)},K=function(n){return n instanceof Set||n instanceof Q&&(n=n.all()),n instanceof R&&(n=n.all()),n instanceof B&&(n=n.get()),new Set(n)},Q=n.ObsSet=function(n){function t(n){u(this,t),null==n&&(n=new Set);var e=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._base=H(n),e.onChange=e._mkEv(function(){return[e._base,new Set]}),e}return e(t,D),o(t,[{key:"has",value:function(n){return this.subAll(function(){var t=Array.from(arguments.length<=0?void 0:arguments[0]),r=l(t,2),e=r[0],u=r[1];return e.has(n)||u.has(n)}),this._base.has(n)}},{key:"all",value:function(){return this.subAll(),new Set(this._base)}},{key:"readonly",value:function(){var n=this;return new X(function(){return n.all()})}},{key:"values",value:function(){return this.all()}},{key:"entries",value:function(){return this.all()}},{key:"size",value:function(){return this.subAll(function(){var n=Array.from(arguments.length<=0?void 0:arguments[0]),t=l(n,2),r=t[0],e=t[1];return r.size!==e.size}),this._base.size}},{key:"union",value:function(n){var t=this;return new X(function(){return c(t.all(),K(n))})}},{key:"intersection",value:function(n){var t=this;return new X(function(){return h(t.all(),K(n))})}},{key:"difference",value:function(n){var t=this;return new X(function(){return v(t.all(),K(n))})}},{key:"symmetricDifference",value:function(n){var t=this;return new X(function(){var r=t.all();return n=K(n),new Set(Array.from(c(r,n)).filter(function(t){return!r.has(t)||!n.has(t)}))})}},{key:"_update",value:function(n){var t=this;return hn(function(){var r=new Set(t._base),e=H(n),u=new Set,i=new Set;return r.forEach(function(n){if(!e.has(n))return i.add(n)}),e.forEach(function(n){if(!r.has(n))return u.add(n)}),r.forEach(function(n){return t._base.delete(n)}),e.forEach(function(n){return t._base.add(n)}),t.onChange.pub([u,i]),r})}}]),t}(),V=n.SrcSet=function(n){function t(){return u(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return e(t,Q),o(t,[{key:"add",value:function(n){var t=this;return C.mutating(function(){return t._base.has(n)||(t._base.add(n),t.onChange.pub([new Set([n]),new Set])),n})}},{key:"put",value:function(n){return this.add(n)}},{key:"delete",value:function(n){var t=this;return C.mutating(function(){return t._base.has(n)&&(t._base.delete(n),t.onChange.pub([new Set,new Set([n])])),n})}},{key:"remove",value:function(n){return this.delete(n)}},{key:"clear",value:function(){var n=this;return C.mutating(function(){var t=new Set(n._base);return n._base.size&&(n._base.clear(),n.onChange.pub([new Set,t])),t})}},{key:"update",value:function(n){var t=this;return C.mutating(function(){return t._update(n)})}}]),t}(),X=n.DepSet=function(n){function t(n){u(this,t);var e=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));e.f=n;var i=x(e.f);return P(i.onSet,function(){var n=Array.from(arguments.length<=0?void 0:arguments[0]),t=l(n,2),r=(t[0],t[1]);return e._update(r)}),e}return e(t,Q),t}(),Y=n.liftSpec=function(n){return a.default.object(function(){var t=[],r=!0,e=!1,u=void 0;try{for(var i,o=Array.from(Object.getOwnPropertyNames(n))[Symbol.iterator]();!(r=(i=o.next()).done);r=!0){var l=i.value,f=n[l];if(null==f||![q,B,R,Q].some(function(n){return f instanceof n})){var s=a.default.isFunction(f)?null:a.default.isArray(f)?"array":f instanceof Set?"set":f instanceof Map?"map":"cell";t.push([l,{type:s,val:f}])}}}catch(n){e=!0,u=n}finally{try{!r&&o.return&&o.return()}finally{if(e)throw u}}return t}())},Z=(n.lift=function(n,t){return null==t&&(t=Y(n)),a.default.mapObject(t,function(t,r){var e=t.type;return!(n[r]instanceof D)&&e in O?en[e](n[r]):n[r]})},n.unlift=function(n){return a.default.mapObject(n,function(n){return n instanceof D?n.all():n})},n.reactify=function n(t,r){var e=void 0;if(a.default.isArray(t)){var u=nn(a.default.clone(t));return Object.defineProperties(t,a.default.object(Object.getOwnPropertyNames(T.prototype).concat(Object.getOwnPropertyNames(R.prototype)).concat(Object.getOwnPropertyNames(D.prototype)).filter(function(n){return"length"!==n}).map(function(n){var r=t[n];return e={configurable:!0,enumerable:!1,value:function(){for(var e,i=void 0,a=arguments.length,o=Array(a),l=0;l<a;l++)o[l]=arguments[l];return null!=r&&(i=r.call.apply(r,[t].concat(o))),(e=u[n]).call.apply(e,[u].concat(o)),i},writable:!0},[n,e]}))),t}return Object.defineProperties(t,a.default.object(function(){var t=[];for(var u in r)e=r[u],t.push(function(t,r){var e=null;switch(r.type){case"cell":var u=$(null!=r.val?r.val:null);e={configurable:!0,enumerable:!0,get:function(){return u.get()},set:function(n){return u.set(n)}};break;case"array":var a=n(null!=r.val?r.val:[]);e={configurable:!0,enumerable:!0,get:function(){return a.all(),a},set:function(n){return a.splice.apply(a,[0,a.length].concat(i(Array.from(n)))),a}};break;default:throw new Error("Unknown observable type: "+type)}return[t,e]}(u,e));return t}()))}),$=(n.autoReactify=function(n){var t=[],r=!0,e=!1,u=void 0;try{for(var i,o=Array.from(Object.getOwnPropertyNames(n))[Symbol.iterator]();!(r=(i=o.next()).done);r=!0){var l=i.value,f=n[l];if(!(f instanceof D)){var s=a.default.isFunction(f)?null:a.default.isArray(f)?"array":"cell";t.push([l,{type:s,val:f}])}}}catch(n){e=!0,u=n}finally{try{!r&&o.return&&o.return()}finally{if(e)throw u}}Z(n,a.default.object(t))},function(n){return new I(n)});n.cell=$,$.from=function(n){return n instanceof B?n:x(n instanceof D?function(){return n.all()}:function(){return n})};var nn=function(n,t){return new T((null!=n?n:[]).map($),t)};n.array=nn,nn.from=function(n,t){var r=void 0;if(n instanceof R)return n;if(a.default.isArray(n))r=function(){return n};else{if(!(n instanceof D))throw new Error("Cannot cast "+n.constructor.name+" to array!");r=function(){return n.all()}}return new U(r,t)};var tn=function(n){return new J(n)};n.map=tn,tn.from=function(n){return n instanceof q?n:new G(n instanceof D?function(){return n.get()}:function(){return n})};var rn=function(n){return new V(n)};n.set=rn,rn.from=function(n){return n instanceof Q?n:new X(n instanceof D?function(){return n.all()}:function(){return n})};var en={cell:$,array:nn,map:tn,set:rn},un=n.cast=function n(t,r){if(null==r&&(r="cell"),[B,R,q,Q].includes(r)){var e=null;switch(r){case B:e="cell";break;case R:e="array";break;case q:e="map";break;case Q:e="set"}r=e}if(a.default.isString(r))return r in O?en[r].from(t):t;var u=t,i=r;return a.default.mapObject(u,function(t,r){return i[r]?n(t,i[r]):t})},an=function(n){return new U(function(){return a.default.chain(on([n])).flatten().filter(function(n){return null!=n}).value()})};n.flatten=an;var on=function n(t){return t instanceof R?n(t.all()):t instanceof Q?n(Array.from(t.values())):t instanceof B?n(t.get()):t instanceof Set?n(Array.from(t)):a.default.isArray(t)?t.map(function(t){return n(t)}):t},ln=(n.cellToArray=function(n,t){return new U(function(){return n.get()},t)},n.cellToMap=function(n){return new G(function(){return n.get()})},n.cellToSet=function(n){return new X(function(){return n.get()})},n.basicDiff=function(n){return null==n&&(n=sn),function(t,r){var e=void 0,u=p(function(){for(var r=[],u=0;u<t.length;u++)e=t[u],r.push([n(e),u]);return r}());return function(){var t=[],i=!0,a=!1,o=void 0;try{for(var l,f=Array.from(r)[Symbol.iterator]();!(i=(l=f.next()).done);i=!0){e=l.value;var s;t.push(null!=(s=u[n(e)])?s:-1)}}catch(n){a=!0,o=n}finally{try{!i&&f.return&&f.return()}finally{if(a)throw o}}return t}()}}),fn=n.uidify=function(n){return null!=n.__rxUid?n.__rxUid:Object.defineProperty(n,"__rxUid",{enumerable:!1,value:s()}).__rxUid},sn=n.smartUidify=function(n){return a.default.isObject(n)?fn(n):JSON.stringify(n)},cn=function(n,t,r){var e=void 0;if(!t.length)return null;var u=function(){var n=[],t=!0,u=!1,i=void 0;try{for(var a,o=Array.from(r)[Symbol.iterator]();!(t=(a=o.next()).done);t=!0)(e=a.value)>=0&&n.push(e)}catch(n){u=!0,i=n}finally{try{!t&&o.return&&o.return()}finally{if(u)throw i}}return n}();if(a.default.some(function(){var n=void 0,t=void 0,r=[];for(e=0,n=0<=(t=u.length-1);n?e<t:e>t;n?e++:e--)r.push(u[e+1]-u[e]<=0);return r}()))return null;var i=[],o=-1;for(e=0;e<r.length;){for(;e<r.length&&r[e]===o+1;)o+=1,e+=1;for(var l={index:e,count:0,additions:[]};e<r.length&&-1===r[e];)l.additions.push(t[e]),e+=1;var f=e===r.length?n:r[e];l.count=f-(o+1),(l.count>0||l.additions.length>0)&&i.push([l.index,l.count,l.additions]),o=f,e+=1}return i},hn=n.transaction=function(n){return b.transaction(n)}});