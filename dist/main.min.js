!function(n,t){if("function"==typeof define&&define.amd)define(["exports","underscore"],t);else if("undefined"!=typeof exports)t(exports,require("underscore"));else{var r={exports:{}};t(r.exports,n.underscore),n.main=r.exports}}(this,function(n,t){"use strict";function r(n,t){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?n:t}function e(n,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(n,t):n.__proto__=t)}function u(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}function i(n){if(Array.isArray(n)){for(var t=0,r=Array(n.length);t<n.length;t++)r[t]=n[t];return r}return Array.from(n)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(n){return n&&n.__esModule?n:{default:n}}(t),o=function(){function n(n,t){for(var r=0;r<t.length;r++){var e=t[r];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(n,e.key,e)}}return function(t,r,e){return r&&n(t.prototype,r),e&&n(t,e),t}}(),l=function(){function n(n,t){var r=[],e=!0,u=!1,i=void 0;try{for(var a,o=n[Symbol.iterator]();!(e=(a=o.next()).done)&&(r.push(a.value),!t||r.length!==t);e=!0);}catch(n){u=!0,i=n}finally{try{!e&&o.return&&o.return()}finally{if(u)throw i}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return n(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();n.default=function(n){var t=void 0,a=void 0,s=void 0,f=void 0,c={},h=0,v=function(){return h+=1},y=function(n,t){return new Set([].concat(i(Array.from(n)),i(Array.from(t))))},p=function(n,t){return new Set(Array.from(n).filter(function(n){return t.has(n)}))},d=function(n,t){return new Set(Array.from(n).filter(function(n){return!t.has(n)}))},g=function(n,t){if(!(t in n))throw new Error("object has no key "+t);var r=n[t];return delete n[t],r},b=function(n,t){var r=n.get(t);return n.delete(t),r},m=function(t){var r=void 0,e=void 0;null==t&&(t=[]);var u=null!=Object.create?Object.create(null):{};if(n.isArray(t)){var i=!0,a=!1,o=void 0;try{for(var s,f=Array.from(t)[Symbol.iterator]();!(i=(s=f.next()).done);i=!0){var c=l(s.value,2);r=c[0],e=c[1],u[r]=e}}catch(n){a=!0,o=n}finally{try{!i&&f.return&&f.return()}finally{if(a)throw o}}}else for(r in t)e=t[r],u[r]=e;return u},_=function(n){var t=0,r=!0,e=!1,u=void 0;try{for(var i,a=Array.from(n)[Symbol.iterator]();!(r=(i=a.next()).done);r=!0)t+=i.value}catch(n){e=!0,u=n}finally{try{!r&&a.return&&a.return()}finally{if(e)throw u}}return t},w=c.DepMgr=function(){function t(){u(this,t),this.buffering=0,this.buffer=[],this.events=new Set}return o(t,[{key:"transaction",value:function(t){var r=void 0;this.buffering+=1;try{r=t()}finally{if(this.buffering-=1,0===this.buffering){var e=new Set(n.flatten(Array.from(this.events).map(function(n){var t=n.downstreamCells;return Array.from(t)}))),u=c.allDownstream.apply(c,i(Array.from(e||[])));u.forEach(function(n){return n._shield=!0});try{var a=this.buffer;this.buffer=[],this.events.clear(),a.map(function(){var n=Array.from(arguments.length<=0?void 0:arguments[0]),t=l(n,2),r=t[0],e=t[1];return r.pub(e)}),u.forEach(function(n){return n.refresh()})}finally{u.forEach(function(n){return n._shield=!1})}}}return r}}]),t}();c._depMgr=s=new w;var k=c.Ev=function(){function n(t,r){u(this,n),this.observable=r,this.init=t,this.subs=m(),this.downstreamCells=new Set}return o(n,[{key:"sub",value:function(n){var t=v();return null!=this.init&&n(this.init()),this.subs[t]=n,t}},{key:"pub",value:function(n){var t=this;return s.buffering?(s.buffer.push([this,n]),s.events.add(this)):function(){var r=[];for(var e in t.subs){var u=t.subs[e];r.push(u(n))}return r}()}},{key:"unsub",value:function(n){return g(this.subs,n)}},{key:"scoped",value:function(n,t){var r=this.sub(n);try{return t()}finally{this.unsub(r)}}}]),n}();c.skipFirst=function(n){var t=!0;return function(){if(t)return t=!1;for(var r=arguments.length,e=Array(r),u=0;u<r;u++)e[u]=arguments[u];return n.apply(void 0,i(Array.from(e||[])))}},c.upstream=function(n){var t=Array.from(n.upstreamEvents).map(function(n){return n.observable});return Array.from(new Set(t))};var A=c._allDownstreamHelper=function(){for(var t=arguments.length,r=Array(t),e=0;e<t;e++)r[e]=arguments[e];if(r.length){var u=Array.from(new Set(n.flatten(r.map(function(n){return Array.from(n.onSet.downstreamCells)}))));return n.flatten([u,A.apply(void 0,i(Array.from(u||[])))])}return[]};c.allDownstream=function(){for(var n=arguments.length,t=Array(n),r=0;r<n;r++)t[r]=arguments[r];return Array.from(new Set([].concat(i(Array.from(t)),i(Array.from(A.apply(void 0,i(Array.from(t||[])))))).reverse())).reverse()};var S=c.Recorder=function(){function t(){u(this,t),this.stack=[],this.isMutating=!1,this.isIgnoring=!1,this.hidingMutationWarnings=!1,this.onMutationWarning=new k}return o(t,[{key:"record",value:function(t,r){this.stack.length>0&&!this.isMutating&&n(this.stack).last().addNestedBind(t),this.stack.push(t);var e=this.isMutating;this.isMutating=!1;var u=this.isIgnoring;this.isIgnoring=!1;try{return r()}finally{this.isIgnoring=u,this.isMutating=e,this.stack.pop()}}},{key:"sub",value:function(t,r){if(null==r&&(r=function(){return!0}),this.stack.length>0&&!this.isIgnoring){var e=n(this.stack).last();return e.upstreamEvents.add(t),t.downstreamCells.add(e),c.autoSub(t,function(){for(var n=arguments.length,t=Array(n),u=0;u<n;u++)t[u]=arguments[u];if(r.apply(void 0,i(Array.from(t||[]))))return e.refresh()})}}},{key:"addCleanup",value:function(t){if(this.stack.length>0)return n(this.stack).last().addCleanup(t)}},{key:"hideMutationWarnings",value:function(n){var t=this.hidingMutationWarnings;this.hidingMutationWarnings=!0;try{return n()}finally{this.hidingMutationWarnings=t}}},{key:"fireMutationWarning",value:function(){return console.warn("Mutation to observable detected during a bind context"),this.onMutationWarning.pub(null)}},{key:"mutating",value:function(n){this.stack.length>0&&!this.hidingMutationWarnings&&this.fireMutationWarning();var t=this.isMutating;this.isMutating=!0;try{return n()}finally{this.isMutating=t}}},{key:"ignoring",value:function(n){var t=this.isIgnoring;this.isIgnoring=!0;try{return n()}finally{this.isIgnoring=t}}}]),t}();c.types={cell:"cell",array:"array",map:"map",set:"set"},c._recorder=f=new S,c.hideMutationWarnings=function(n){return f.hideMutationWarnings(n)},c.asyncBind=t=function(n,t){var r=new x(t,n);return r.refresh(),r},c.promiseBind=function(n,r){return t(n,function(){var n=this;return this.record(r).done(function(t){return n.done(t)})})},c.bind=a=function(n){return t(null,function(){return this.done(this.record(n))})},c.lagBind=function(n,r,e){var u=null;return t(r,function(){var t=this;return null!=u&&clearTimeout(u),u=setTimeout(function(){return t.done(t.record(e))},n)})},c.postLagBind=function(n,r){var e=null;return t(n,function(){var n=this,t=this.record(r),u=t.val,i=t.ms;return null!=e&&clearTimeout(e),e=setTimeout(function(){return n.done(u)},i)})},c.snap=function(n){return f.ignoring(n)},c.onDispose=function(n){return f.addCleanup(n)},c.autoSub=function(n,t){var r=n.sub(t);return c.onDispose(function(){return n.unsub(r)}),r},c.subOnce=function(t,r){var e=c.autoSub(t,c.skipFirst(function(){for(var u=arguments.length,a=Array(u),o=0;o<u;o++)a[o]=arguments[o];return n.defer(function(){return r.apply(void 0,i(Array.from(a||[])))}),t.unsub(e)}));return e};var O=function(){var n=c.ObsBase=function(){function n(){u(this,n),this.events=[]}return o(n,null,[{key:"initClass",value:function(){var n=this;this.prototype.to={cell:function(){return c.cell.from(n)},array:function(){return c.array.from(n)},map:function(){return c.map.from(n)},set:function(){return c.set.from(n)}}}}]),o(n,[{key:"flatten",value:function(){return c.flatten(this)}},{key:"subAll",value:function(n){return null==n&&(n=function(){return!0}),this.events.forEach(function(t){return f.sub(t,n)})}},{key:"raw",value:function(){return this._base}},{key:"_mkEv",value:function(n){var t=new k(n,this);return this.events.push(t),t}}]),n}();return n.initClass(),n}(),C=c.ObsCell=function(n){function t(n){u(this,t);var e=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));e._base=null!=n?n:null,e.onSet=e._mkEv(function(){return[null,e._base]}),e._shield=!1;var a=function(){return e.onSet.downstreamCells};return e.refreshAll=function(){if(e.onSet.downstreamCells.size&&!e._shield){e._shield=!0;var n=c.allDownstream.apply(c,i(Array.from(Array.from(a())||[])));n.forEach(function(n){return n._shield=!0});try{return n.forEach(function(n){return n.refresh()})}finally{n.forEach(function(n){return n._shield=!1}),e._shield=!1}}},e.refreshSub=c.autoSub(e.onSet,e.refreshAll),e}return e(t,O),o(t,[{key:"all",value:function(){var n=this;return this.subAll(function(){return!n._shield}),this._base}},{key:"get",value:function(){return this.all()}},{key:"readonly",value:function(){var n=this;return new x(function(){return n.all()})}}]),t}(),M=c.SrcCell=function(n){function t(){return u(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return e(t,C),o(t,[{key:"set",value:function(n){var t=this;return f.mutating(function(){if(t._base!==n){var r=t._base;return t._base=n,t.onSet.pub([r,n]),r}})}}]),t}(),x=c.DepCell=function(n){function t(n,e){u(this,t);var i=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,null!=e?e:null));return i.body=null!=n?n:null,i.refreshing=!1,i.nestedBinds=[],i.cleanups=[],i.upstreamEvents=new Set,i}return e(t,C),o(t,[{key:"refresh",value:function(){var n=this;if(!this.refreshing){var t=this._base,r=function(r){return n._base=r,n.onSet.pub([t,n._base])},e=!1,u=null,i=!1,a={record:function(t){if(!n.refreshing){var o=void 0;if(n.disconnect(),e)throw new Error("this refresh has already recorded its dependencies");n.refreshing=!0,e=!0;try{o=f.record(n,function(){return t.call(a)})}finally{n.refreshing=!1}return i&&r(u),o}},done:function(e){if(t!==e)return n.refreshing?(i=!0,u=e):r(e)}};return this.body.call(a)}}},{key:"disconnect",value:function(){var n=this,t=!0,r=!1,e=void 0;try{for(var u,i=Array.from(this.cleanups)[Symbol.iterator]();!(t=(u=i.next()).done);t=!0)(0,u.value)()}catch(n){r=!0,e=n}finally{try{!t&&i.return&&i.return()}finally{if(r)throw e}}var a=!0,o=!1,l=void 0;try{for(var s,f=Array.from(this.nestedBinds)[Symbol.iterator]();!(a=(s=f.next()).done);a=!0)s.value.disconnect()}catch(n){o=!0,l=n}finally{try{!a&&f.return&&f.return()}finally{if(o)throw l}}return this.nestedBinds=[],this.cleanups=[],this.upstreamEvents.forEach(function(t){return t.downstreamCells.delete(n)}),this.upstreamEvents.clear()}},{key:"addNestedBind",value:function(n){return this.nestedBinds.push(n)}},{key:"addCleanup",value:function(n){return this.cleanups.push(n)}}]),t}(),j=c.ObsArray=function(n){function t(n,e){u(this,t),null==n&&(n=[]),null==e&&(e=c.basicDiff());var i=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i._cells=n,i.diff=e,i.onChange=i._mkEv(function(){return[0,[],i._cells.map(function(n){return n.raw()})]}),i.onChangeCells=i._mkEv(function(){return[0,[],i._cells]}),i._indexed=null,i}return e(t,O),o(t,[{key:"all",value:function(){return f.sub(this.onChange),this._cells.map(function(n){return n.get()})}},{key:"raw",value:function(){return this._cells.map(function(n){return n.raw()})}},{key:"readonly",value:function(){var n=this;return new z(function(){return n.all()})}},{key:"rawCells",value:function(){return this._cells}},{key:"at",value:function(n){return f.sub(this.onChange,function(){var t=Array.from(arguments.length<=0?void 0:arguments[0]),r=l(t,3),e=r[0],u=r[1],i=r[2];return e<=n&&u.length!==i.length||u.length===i.length&&n<=e+u.length}),null!=this._cells[n]?this._cells[n].get():void 0}},{key:"length",value:function(){return f.sub(this.onChangeCells,function(){var n=Array.from(arguments.length<=0?void 0:arguments[0]),t=l(n,3),r=(t[0],t[1]),e=t[2];return r.length!==e.length}),this._cells.length}},{key:"size",value:function(){return this.length()}},{key:"map",value:function(n){var t=new P;return c.autoSub(this.onChangeCells,function(){var r=Array.from(arguments.length<=0?void 0:arguments[0]),e=l(r,3),u=e[0],i=e[1],o=e[2],s=!0,f=!1,c=void 0;try{for(var h,v=Array.from(t._cells.slice(u,u+i.length))[Symbol.iterator]();!(s=(h=v.next()).done);s=!0){var y=h.value;y.disconnect()}}catch(n){f=!0,c=n}finally{try{!s&&v.return&&v.return()}finally{if(f)throw c}}var p=o.map(function(t){return y=a(function(){return n(t.get())})});return t.realSpliceCells(u,i.length,p)}),t}},{key:"transform",value:function(n,t){var r=this;return new z(function(){return n(r.all())},t)}},{key:"filter",value:function(n){return this.transform(function(t){return t.filter(n)})}},{key:"slice",value:function(n,t){return this.transform(function(r){return r.slice(n,t)})}},{key:"reduce",value:function(n,t){return this.all().reduce(n,null!=t?t:this.at(0))}},{key:"reduceRight",value:function(n,t){return this.all().reduceRight(n,null!=t?t:this.at(0))}},{key:"every",value:function(n){return this.all().every(n)}},{key:"some",value:function(n){return this.all().some(n)}},{key:"indexOf",value:function(n,t){return null==t&&(t=0),this.all().indexOf(n,t)}},{key:"lastIndexOf",value:function(n,t){return null==t&&(t=this.length()-1),this.all().lastIndexOf(n,t)}},{key:"join",value:function(n){return null==n&&(n=","),this.all().join(n)}},{key:"first",value:function(){return this.at(0)}},{key:"last",value:function(){return this.at(this.length()-1)}},{key:"indexed",value:function(){var n=this;return null==this._indexed&&(this._indexed=new D,c.autoSub(this.onChangeCells,function(){var t=Array.from(arguments.length<=0?void 0:arguments[0]),r=l(t,3),e=r[0],u=r[1],i=r[2];return n._indexed.realSpliceCells(e,u.length,i)})),this._indexed}},{key:"concat",value:function(){for(var n=arguments.length,t=Array(n),r=0;r<n;r++)t[r]=arguments[r];return c.concat.apply(c,[this].concat(i(Array.from(t))))}},{key:"realSpliceCells",value:function(n,t,r){var e=this,u=this._cells.splice.apply(this._cells,[n,t].concat(r)),i=c.snap(function(){return Array.from(u).map(function(n){return n.get()})}),a=c.snap(function(){return Array.from(r).map(function(n){return n.get()})});return c.transaction(function(){return e.onChangeCells.pub([n,u,r]),e.onChange.pub([n,i,a])})}},{key:"realSplice",value:function(n,t,r){return this.realSpliceCells(n,t,r.map(c.cell))}},{key:"_update",value:function(n,t){var r=this,e=void 0;null==t&&(t=this.diff);var u=c.snap(function(){return Array.from(r._cells).map(function(n){return n.get()})}),i=[0,u.length,n],a=null!=t&&null!=(e=J(u.length,n,t(u,n)))?e:[i];return function(){var n=[],t=!0,e=!1,u=void 0;try{for(var i,o=Array.from(a)[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var s=i.value,f=Array.from(s),c=l(f,3),h=c[0],v=c[1],y=c[2];n.push(r.realSplice(h,v,y))}}catch(n){e=!0,u=n}finally{try{!t&&o.return&&o.return()}finally{if(e)throw u}}return n}()}}]),t}(),E=c.SrcArray=function(t){function i(){return u(this,i),r(this,(i.__proto__||Object.getPrototypeOf(i)).apply(this,arguments))}return e(i,j),o(i,[{key:"spliceArray",value:function(n,t,r){var e=this;return f.mutating(function(){return e.realSplice(n,t,r)})}},{key:"splice",value:function(n,t){for(var r=arguments.length,e=Array(r>2?r-2:0),u=2;u<r;u++)e[u-2]=arguments[u];return this.spliceArray(n,t,e)}},{key:"insert",value:function(n,t){return this.splice(t,0,n)}},{key:"remove",value:function(t){var r=n(this.raw()).indexOf(t);if(r>=0)return this.removeAt(r)}},{key:"removeAll",value:function(t){var r=this;return c.transaction(function(){var e=n(c.snap(function(){return r.all()})).indexOf(t);return function(){for(var u=[];e>=0;)r.removeAt(e),u.push(e=n(c.snap(function(){return r.all()})).indexOf(t));return u}()})}},{key:"removeAt",value:function(n){var t=this,r=c.snap(function(){return t.at(n)});return this.splice(n,1),r}},{key:"push",value:function(n){var t=this;return this.splice(c.snap(function(){return t.length()}),0,n)}},{key:"pop",value:function(){var n=this;return this.removeAt(c.snap(function(){return n.length()-1}))}},{key:"put",value:function(n,t){return this.splice(n,1,t)}},{key:"replace",value:function(n){var t=this;return this.spliceArray(0,c.snap(function(){return t.length()}),n)}},{key:"unshift",value:function(n){return this.insert(n,0)}},{key:"shift",value:function(){return this.removeAt(0)}},{key:"update",value:function(n){var t=this;return f.mutating(function(){return t._update(n)})}},{key:"move",value:function(n,t){var r=this;return c.transaction(function(){if(n!==t){var e=c.snap(function(){return r.length()});if(n<0||n>e-1)throw"Source "+n+" is outside of bounds of array of length "+e;if(t<0||t>e)throw"Destination "+t+" is outside of bounds of array of length "+e;var u=c.snap(function(){return r.all()[n]});n>t?(r.removeAt(n),r.insert(u,t)):(r.insert(u,t),r.removeAt(n))}})}},{key:"swap",value:function(n,t){var r=this;return c.transaction(function(){var e=c.snap(function(){return r.length()});if(n<0||n>e-1)throw"i1 "+n+" is outside of bounds of array of length "+e;if(t<0||t>e-1)throw"i2 "+t+" is outside of bounds of array of length "+e;var u=Math.min(n,t),i=Math.max(n,t);return r.move(u,i),r.move(i,u)})}},{key:"reverse",value:function(){var n=this;return this.update(c.snap(function(){return n.all().reverse()})),c.snap(function(){return n.all()})}}]),i}(),P=c.MappedDepArray=function(n){function t(){return u(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return e(t,j),t}(),D=c.IndexedDepArray=function(t){function s(t,e){u(this,s),null==t&&(t=[]);var i=r(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,t,e));return i.is=Array.from(i._cells).map(function(n,t){return c.cell(t)}),i.onChangeCells=i._mkEv(function(){return[0,[],n.zip(i._cells,i.is)]}),i.onChange=i._mkEv(function(){return[0,[],n.zip(i.is,c.snap(function(){return i.all()}))]}),i}return e(s,j),o(s,[{key:"map",value:function(n){var t=new P;return c.autoSub(this.onChangeCells,function(){var r=Array.from(arguments.length<=0?void 0:arguments[0]),e=l(r,3),u=e[0],i=e[1],o=e[2],s=!0,f=!1,c=void 0;try{for(var h,v=Array.from(t._cells.slice(u,u+i.length))[Symbol.iterator]();!(s=(h=v.next()).done);s=!0){var y=h.value;y.disconnect()}}catch(n){f=!0,c=n}finally{try{!s&&v.return&&v.return()}finally{if(f)throw c}}var p=function(){var t=[],r=!0,e=!1,u=void 0;try{for(var i,s=Array.from(o)[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var f=l(i.value,2),c=f[0],h=f[1];t.push(y=a(function(){return n(c.get(),h)}))}}catch(n){e=!0,u=n}finally{try{!r&&s.return&&s.return()}finally{if(e)throw u}}return t}();return t.realSpliceCells(u,i.length,p)}),t}},{key:"realSpliceCells",value:function(t,r,e){for(var u,a=this,o=void 0,l=this._cells.splice.apply(this._cells,[t,r].concat(e)),s=c.snap(function(){return Array.from(l).map(function(n){return n.get()})}),f=this.is.slice(t+r),h=0;h<f.length;h++)(o=f[h]).set(t+e.length+h);var v=function(){var n=void 0,r=void 0,u=[];for(o=0,n=0<=(r=e.length);n?o<r:o>r;n?o++:o--)u.push(c.cell(t+o));return u}();(u=this.is).splice.apply(u,[t,r].concat(i(Array.from(v))));var y=c.snap(function(){return Array.from(e).map(function(n){return n.get()})});return c.transaction(function(){return a.onChangeCells.pub([t,l,n.zip(e,v)]),a.onChange.pub([t,s,n.zip(y,v)])})}}]),s}(),z=(c.IndexedMappedDepArray=function(n){function t(){return u(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return e(t,D),t}(),c.DepArray=function(n){function t(n,e){u(this,t);var i=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,[],e));return i.f=n,c.autoSub(a(function(){return Array.from(i.f())}).onSet,function(){var n=Array.from(arguments.length<=0?void 0:arguments[0]),t=l(n,2),r=(t[0],t[1]);return i._update(r)}),i}return e(t,j),t}());c.IndexedArray=function(n){function t(n){u(this,t);var e=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._cells=n,e}return e(t,z),o(t,[{key:"map",value:function(n){var t=new P;return c.autoSub(this._cells.onChange,function(){var r=Array.from(arguments.length<=0?void 0:arguments[0]),e=l(r,3),u=e[0],i=e[1],a=e[2];return t.realSplice(u,i.length,a.map(n))}),t}}]),t}();c.concat=function(){for(var n=arguments.length,t=Array(n),r=0;r<n;r++)t[r]=arguments[r];var e=void 0,u=new P,i=t.map(function(n){return c.cast(n,"array")}),a=function(){var n=[],r=!0,u=!1,i=void 0;try{for(var a,o=Array.from(t)[Symbol.iterator]();!(r=(a=o.next()).done);r=!0)e=a.value,n.push(0)}catch(n){u=!0,i=n}finally{try{!r&&o.return&&o.return()}finally{if(u)throw i}}return n}();return i.forEach(function(n,t){return c.autoSub(n.onChange,function(){var n=Array.from(arguments.length<=0?void 0:arguments[0]),r=l(n,3),e=r[0],i=r[1],o=r[2],s=_(a.slice(0,t));return a[t]+=o.length-i.length,u.realSplice(s+e,i.length,o)})}),u};var I=function(t){return t instanceof Map?t:n.isArray(t)?new Map(t):new Map(n.pairs(t))},R=c.ObsMap=function(t){function i(n){u(this,i),null==n&&(n=new Map);var t=r(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return t._base=I(n),t.onAdd=t._mkEv(function(){return new Map(t._base)}),t.onRemove=t._mkEv(function(){return new Map}),t.onChange=t._mkEv(function(){return new Map}),t}return e(i,O),o(i,[{key:"get",value:function(n){return this.subAll(function(t){return t.has(n)}),this._base.get(n)}},{key:"has",value:function(n){return f.sub(this.onAdd,function(t){return t.has(n)}),f.sub(this.onRemove,function(t){return t.has(n)}),this._base.has(n)}},{key:"all",value:function(){return this.subAll(),new Map(this._base)}},{key:"readonly",value:function(){var n=this;return new W(function(){return n.all()})}},{key:"size",value:function(){return f.sub(this.onRemove),f.sub(this.onAdd),this._base.size}},{key:"realPut",value:function(n,t){if(this._base.has(n)){var r=this._base.get(n);return r!==t&&(this._base.set(n,t),this.onChange.pub(new Map([[n,[r,t]]]))),r}return this._base.set(n,t),void this.onAdd.pub(new Map([[n,t]]))}},{key:"realRemove",value:function(n){var t=b(this._base,n);return this.onRemove.pub(new Map([[n,t]])),t}},{key:"_update",value:function(t){var r=this,e=void 0,u=I(t),i=new Map(this._base),a=n.chain(Array.from(r._base.keys())).difference(Array.from(u.keys())).map(function(n){return[n,b(r._base,n)]}).value(),o=n.chain(Array.from(u.keys())).difference(Array.from(r._base.keys())).map(function(n){return e=u.get(n),r._base.set(n,e),[n,e]}).value(),s=function(){var t=void 0;return n.chain(Array.from(u)).filter(function(){var n=Array.from(arguments.length<=0?void 0:arguments[0]),u=l(n,2);return t=u[0],e=u[1],r._base.has(t)&&r._base.get(t)!==e}).map(function(){var n=Array.from(arguments.length<=0?void 0:arguments[0]),u=l(n,2);t=u[0],e=u[1];var i=r._base.get(t);return r._base.set(t,e),[t,[i,e]]}).value()}();return c.transaction(function(){if(a.length&&r.onRemove.pub(new Map(a)),o.length&&r.onAdd.pub(new Map(o)),s.length)return r.onChange.pub(new Map(s))}),i}}]),i}(),B=c.SrcMap=function(n){function t(){return u(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return e(t,R),o(t,[{key:"put",value:function(n,t){var r=this;return f.mutating(function(){return r.realPut(n,t)})}},{key:"set",value:function(n,t){return this.put(n,t)}},{key:"delete",value:function(n){var t=this;return f.mutating(function(){var r=void 0;return t._base.has(n)&&(r=t.realRemove(n),t.onRemove.pub(new Map([[n,r]]))),r})}},{key:"remove",value:function(n){return this.delete(n)}},{key:"clear",value:function(){var n=this;return f.mutating(function(){var t=new Map(n._base);return n._base.clear(),t.size&&n.onRemove.pub(t),t})}},{key:"update",value:function(n){var t=this;return f.mutating(function(){return t._update(n)})}}]),t}(),W=c.DepMap=function(n){function t(n){u(this,t);var e=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));e.f=n;var i=a(e.f);return c.autoSub(i.onSet,function(){var n=Array.from(arguments.length<=0?void 0:arguments[0]),t=l(n,2),r=(t[0],t[1]);return e._update(r)}),e}return e(t,R),t}(),T=function(n){return n instanceof Set?n:new Set(n)},N=function(n){return n instanceof Set||n instanceof U&&(n=n.all()),n instanceof j&&(n=n.all()),n instanceof C&&(n=n.get()),new Set(n)},U=c.ObsSet=function(n){function t(n){u(this,t),null==n&&(n=new Set);var e=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._base=T(n),e.onChange=e._mkEv(function(){return[e._base,new Set]}),e}return e(t,O),o(t,[{key:"has",value:function(n){return this.subAll(function(){var t=Array.from(arguments.length<=0?void 0:arguments[0]),r=l(t,2),e=r[0],u=r[1];return e.has(n)||u.has(n)}),this._base.has(n)}},{key:"all",value:function(){return this.subAll(),new Set(this._base)}},{key:"readonly",value:function(){var n=this;return new q(function(){return n.all()})}},{key:"values",value:function(){return this.all()}},{key:"entries",value:function(){return this.all()}},{key:"size",value:function(){return this.subAll(function(){var n=Array.from(arguments.length<=0?void 0:arguments[0]),t=l(n,2),r=t[0],e=t[1];return r.size!==e.size}),this._base.size}},{key:"union",value:function(n){var t=this;return new q(function(){return y(t.all(),N(n))})}},{key:"intersection",value:function(n){var t=this;return new q(function(){return p(t.all(),N(n))})}},{key:"difference",value:function(n){var t=this;return new q(function(){return d(t.all(),N(n))})}},{key:"symmetricDifference",value:function(n){var t=this;return new q(function(){var r=t.all();return n=N(n),new Set(Array.from(y(r,n)).filter(function(t){return!r.has(t)||!n.has(t)}))})}},{key:"_update",value:function(n){var t=this;return c.transaction(function(){var r=new Set(t._base),e=T(n),u=new Set,i=new Set;return r.forEach(function(n){if(!e.has(n))return i.add(n)}),e.forEach(function(n){if(!r.has(n))return u.add(n)}),r.forEach(function(n){return t._base.delete(n)}),e.forEach(function(n){return t._base.add(n)}),t.onChange.pub([u,i]),r})}}]),t}(),F=c.SrcSet=function(n){function t(){return u(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return e(t,U),o(t,[{key:"add",value:function(n){var t=this;return f.mutating(function(){return t._base.has(n)||(t._base.add(n),t.onChange.pub([new Set([n]),new Set])),n})}},{key:"put",value:function(n){return this.add(n)}},{key:"delete",value:function(n){var t=this;return f.mutating(function(){return t._base.has(n)&&(t._base.delete(n),t.onChange.pub([new Set,new Set([n])])),n})}},{key:"remove",value:function(n){return this.delete(n)}},{key:"clear",value:function(){var n=this;return f.mutating(function(){var t=new Set(n._base);return n._base.size&&(n._base.clear(),n.onChange.pub([new Set,t])),t})}},{key:"update",value:function(n){var t=this;return f.mutating(function(){return t._update(n)})}}]),t}(),q=c.DepSet=function(n){function t(n){u(this,t);var e=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));e.f=n;var i=a(e.f);return c.autoSub(i.onSet,function(){var n=Array.from(arguments.length<=0?void 0:arguments[0]),t=l(n,2),r=(t[0],t[1]);return e._update(r)}),e}return e(t,U),t}();c.cellToSet=function(n){return new c.DepSet(function(){return n.get()})},c.liftSpec=function(t){return n.object(function(){var r=[],e=!0,u=!1,i=void 0;try{for(var a,o=Array.from(Object.getOwnPropertyNames(t))[Symbol.iterator]();!(e=(a=o.next()).done);e=!0){var l=a.value,s=t[l];if(null==s||![c.ObsMap,c.ObsCell,c.ObsArray,c.ObsSet].some(function(n){return s instanceof n})){var f=n.isFunction(s)?null:n.isArray(s)?"array":s instanceof Set?"set":s instanceof Map?"map":"cell";r.push([l,{type:f,val:s}])}}}catch(n){u=!0,i=n}finally{try{!e&&o.return&&o.return()}finally{if(u)throw i}}return r}())},c.lift=function(t,r){return null==r&&(r=c.liftSpec(t)),n.mapObject(r,function(n,r){var e=n.type;return!(t[r]instanceof O)&&e in c.types?c[e](t[r]):t[r]})},c.unlift=function(t){return n.mapObject(t,function(n){return n instanceof c.ObsBase?n.all():n})},c.reactify=function(t,r){var e=void 0;if(n.isArray(t)){var u=c.array(n.clone(t));return Object.defineProperties(t,n.object(Object.getOwnPropertyNames(E.prototype).concat(Object.getOwnPropertyNames(j.prototype)).concat(Object.getOwnPropertyNames(O.prototype)).filter(function(n){return"length"!==n}).map(function(n){var r=t[n];return e={configurable:!0,enumerable:!1,value:function(){for(var e,i=void 0,a=arguments.length,o=Array(a),l=0;l<a;l++)o[l]=arguments[l];return null!=r&&(i=r.call.apply(r,[t].concat(o))),(e=u[n]).call.apply(e,[u].concat(o)),i},writable:!0},[n,e]}))),t}return Object.defineProperties(t,n.object(function(){var n=[];for(var t in r)e=r[t],n.push(function(n,t){var r=null;switch(t.type){case"cell":var e=c.cell(null!=t.val?t.val:null);r={configurable:!0,enumerable:!0,get:function(){return e.get()},set:function(n){return e.set(n)}};break;case"array":var u=c.reactify(null!=t.val?t.val:[]);r={configurable:!0,enumerable:!0,get:function(){return u.all(),u},set:function(n){return u.splice.apply(u,[0,u.length].concat(i(Array.from(n)))),u}};break;default:throw new Error("Unknown observable type: "+type)}return[n,r]}(t,e));return n}()))},c.autoReactify=function(t){return c.reactify(t,n.object(function(){var r=[],e=!0,u=!1,i=void 0;try{for(var a,o=Array.from(Object.getOwnPropertyNames(t))[Symbol.iterator]();!(e=(a=o.next()).done);e=!0){var l=a.value,s=t[l];if(!(s instanceof O)){var f=n.isFunction(s)?null:n.isArray(s)?"array":"cell";r.push([l,{type:f,val:s}])}}}catch(n){u=!0,i=n}finally{try{!e&&o.return&&o.return()}finally{if(u)throw i}}return r}()))},c.cell=function(n){return new M(n)},c.cell.from=function(n){return n instanceof C?n:a(n instanceof O?function(){return n.all()}:function(){return n})},c.array=function(n,t){return new E((null!=n?n:[]).map(c.cell),t)},c.array.from=function(t,r){var e=void 0;if(t instanceof c.ObsArray)return t;if(n.isArray(t))e=function(){return t};else{if(!(t instanceof O))throw new Error("Cannot cast "+t.constructor.name+" to array!");e=function(){return t.all()}}return new z(e,r)},c.map=function(n){return new B(n)},c.map.from=function(n){return n instanceof c.ObsMap?n:new W(n instanceof O?function(){return n.get()}:function(){return n})},c.set=function(n){return new F(n)},c.set.from=function(n){return n instanceof c.ObsSet?n:new q(n instanceof c.ObsBase?function(){return n.all()}:function(){return n})},c.cast=function(t,r){if(null==r&&(r="cell"),[C,j,R,U].includes(r)){var e=null;switch(r){case C:e="cell";break;case j:e="array";break;case R:e="map";break;case U:e="set"}r=e}if(n.isString(r))return r in c.types?c[r].from(t):t;var u=t,i=r;return n.mapObject(u,function(n,t){return i[t]?c.cast(n,i[t]):n})},c.flatten=function(t){return new z(function(){return n.chain(H([t])).flatten().filter(function(n){return null!=n}).value()})};var H=function t(r){return r instanceof j?t(r.all()):r instanceof U?t(Array.from(r.values())):r instanceof C?t(r.get()):r instanceof Set?t(Array.from(r)):n.isArray(r)?r.map(function(n){return t(n)}):r};c.cellToArray=function(n,t){return new z(function(){return n.get()},t)},c.cellToMap=function(n){return new c.DepMap(function(){return n.get()})},c.cellToSet=function(n){return new c.DepSet(function(){return n.get()})},c.basicDiff=function(n){return null==n&&(n=c.smartUidify),function(t,r){var e=void 0,u=m(function(){for(var r=[],u=0;u<t.length;u++)e=t[u],r.push([n(e),u]);return r}());return function(){var t=[],i=!0,a=!1,o=void 0;try{for(var l,s=Array.from(r)[Symbol.iterator]();!(i=(l=s.next()).done);i=!0){e=l.value;var f;t.push(null!=(f=u[n(e)])?f:-1)}}catch(n){a=!0,o=n}finally{try{!i&&s.return&&s.return()}finally{if(a)throw o}}return t}()}},c.uidify=function(n){return null!=n.__rxUid?n.__rxUid:Object.defineProperty(n,"__rxUid",{enumerable:!1,value:v()}).__rxUid},c.smartUidify=function(t){return n.isObject(t)?c.uidify(t):JSON.stringify(t)};var J=function(t,r,e){var u=void 0;if(!r.length)return null;var i=function(){var n=[],t=!0,r=!1,i=void 0;try{for(var a,o=Array.from(e)[Symbol.iterator]();!(t=(a=o.next()).done);t=!0)(u=a.value)>=0&&n.push(u)}catch(n){r=!0,i=n}finally{try{!t&&o.return&&o.return()}finally{if(r)throw i}}return n}();if(n.some(function(){var n=void 0,t=void 0,r=[];for(u=0,n=0<=(t=i.length-1);n?u<t:u>t;n?u++:u--)r.push(i[u+1]-i[u]<=0);return r}()))return null;var a=[],o=-1;for(u=0;u<e.length;){for(;u<e.length&&e[u]===o+1;)o+=1,u+=1;for(var l={index:u,count:0,additions:[]};u<e.length&&-1===e[u];)l.additions.push(r[u]),u+=1;var s=u===e.length?t:e[u];l.count=s-(o+1),(l.count>0||l.additions.length>0)&&a.push([l.index,l.count,l.additions]),o=s,u+=1}return a};return c.transaction=function(n){return s.transaction(n)},c}(a.default)});